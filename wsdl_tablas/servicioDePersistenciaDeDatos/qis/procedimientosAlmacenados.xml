<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="qis.procedimientosAlmacenados">


	<resultMap class="java.util.HashMap" id="c04">
		<result property="ponderador" column="ponderador" javaType="double"/>
		<result property="otrosActivos" column="otros_activos" javaType="double"/>
		<result property="inveerr" column="inveerr" javaType="double"/>
		<result property="tradingBook" column="trading_book" javaType="double"/>
		<result property="corporate" column="corporate" javaType="double"/>
		<result property="corpEquiv" column="corp_equiv" javaType="double"/>
		<result property="sovereing" column="sovereing" javaType="double"/>

		<result property="bank" column="bank" javaType="double"/>
		<result property="inverVenta" column="inver_venta" javaType="double"/>
		<result property="bankEquiv" column="bank_equiv" javaType="double"/>
		<result property="mortage" column="mortage" javaType="double"/>
		<result property="nonMorta" column="non_morta" javaType="double"/>

		<result property="smeCorp" column="sme_corp" javaType="double"/>
		<result property="smeReta" column="sme_reta" javaType="double"/>
		<result property="pacto" column="pacto" javaType="double"/>
		<result property="provision" column="provision" javaType="double"/>
		<result property="cuadratura" column="cuadratura" javaType="double"/>
		<result property="difFilial" column="dif_filial" javaType="double"/>
	
		<result property="total" column="total" javaType="double"/>
		<result property="diferencias" column="diferencias" javaType="double"/>
	</resultMap>

	<procedure id="proc_obtener_resultado_ro" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_obtener_resultado_ro(#periodo#)}
	</procedure>
	<procedure id="proc_upd_resultado_ro" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_upd_resultado_ro(#periodo#,#campo#,#valor#,#usuario#)}
	</procedure>
	<procedure id="proc_upd_resultado_rm" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_upd_resultado_rm(#periodo#,#campo#,#valor#,#usuario#)}
	</procedure>


	<procedure id="proc_resultado_rm_ti_libro" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_ti_libro(#periodo#,#libro#)}
	</procedure>
	<procedure id="proc_resultado_rm_ti_tc" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_ti_tc(#periodo#,#libro#,#tipoInstrumento#)}
	</procedure>
	<procedure id="proc_resultado_rm_inv_tc_val" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_inv_tc_val(#periodo#,#libro#,#tipoInstrumento#,#contraparte#)}
	</procedure>
	<procedure id="proc_resultado_rm_inv_ti_tot" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_inv_ti_tot(#periodo#,#libro#,#tipoInstrumento#)}
	</procedure>
	<procedure id="proc_resultado_rm_inv_lib_tot" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_inv_lib_tot(#periodo#,#libro#)}
	</procedure>
	<procedure id="proc_resultado_rm_inv_hoj_tot" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_inv_hoj_tot(#periodo#)}
	</procedure>
	<procedure id="proc_resultado_rm_tramo_tc" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_tramo_tc(#periodo#,#tramo#)}
	</procedure>
	<procedure id="proc_resultado_rm_ope_tc_tot" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_ope_tc_tot(#periodo#,#tramo#)}
	</procedure>
	<procedure id="proc_resultado_rm_ope_hoj_tot" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_ope_hoj_tot(#periodo#)}
	</procedure>
	<procedure id="proc_resultado_rm_ope_tc_val" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_ope_tc_val(#periodo#,#tramo#,#contraparte#)}
	</procedure>
	<procedure id="proc_resultado_rm_pacto_tc" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_pacto_tc(#periodo#)}
	</procedure>
	<procedure id="proc_resultado_rm_pacto_tc_val" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_pacto_tc_val(#periodo#,#contraparte#)}
	</procedure>
	<procedure id="proc_resultado_rm_pac_hoj_tot" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_pac_hoj_tot(#periodo#)}
	</procedure>

	<procedure id="proc_resultado_rm_constrading" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rm_constrading(#periodo#,#tramo#)}
	</procedure>


<!-- Riesgo credito -->

	<procedure id="proc_upd_resultado_rc" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_upd_resultado_rc(#periodo#,#campo#,#valor#,#usuario#)}
	</procedure>
	<procedure id="proc_resultado_rc_td" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rc_td(#periodo#,#plantilla#)}
	</procedure>
	<procedure id="proc_resultado_rc_tramos" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rc_tramos(#periodo#,#tipoDeudor#,#plantilla#)}
	</procedure>
	<procedure id="proc_resultado_rc_val_tramo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rc_val_tramo(#periodo#,#tramo#,#tipoDeudor#,#plantilla#)}
	</procedure>
	<procedure id="proc_resultado_rc_tot_td" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rc_tot_td(#periodo#,#plantilla#,#tipoDeudor#)}
	</procedure>
	<procedure id="proc_resultado_rc_tdtot" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rc_tdtot(#periodo#,#plantilla#)}
	</procedure>



	<procedure id="proc_periodo_activo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_periodo_activo()}
	</procedure>

	<procedure id="proc_resultado_c04" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_c04(#periodo#)}
	</procedure>


	<procedure id="proc_resultado_rc_rsm" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rc_rsm(#periodo#,#switch#)}
	</procedure>
	<procedure id="proc_resultado_rc_rsof" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rc_rsof(#periodo#,#switch#)}
	</procedure>
	<procedure id="proc_resultado_rc_cons_bal_rsm" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rc_cons_bal_rsm(#periodo#,#switch#)}
	</procedure>
	<procedure id="proc_resultado_rc_hipo_bal_rsm" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_rc_hipo_bal_rsm(#periodo#,#switch#)}
	</procedure>
	<procedure id="proc_resultado_c04_rsm" parameterClass="java.util.HashMap" resultMap="c04" >
	  {CALL proc_resultado_c04_rsm(#periodo#)}
	</procedure>

<!-- Planilla C43 -->

	<procedure id="proc_resultado_c43" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_resultado_c43(#periodo#)}
	</procedure>


<!-- Otros activos, planilla base qis -->
	<procedure id="proc_obtener_otros_activos" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_obtener_otros_activos(#periodo#)}
	</procedure>


	<procedure id="proc_rep_cerrado" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_rep_cerrado(#periodo#,#reporte#)}
	</procedure>
	<procedure id="proc_cerrar_reporte" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
	  {CALL proc_cerrar_reporte(#periodo#,#reporte#)}
	</procedure>
	
	<!-- INICIO QIS FASE 2 SEGUNDA ETAPA -->
	<resultMap class="java.util.HashMap" id="detalle_c04">
		<result property="codigoContable" column="codigo_contable" javaType="String"/>
		<result property="saldo" column="total" javaType="double"/>
	</resultMap>
	
	<resultMap class="java.util.HashMap" id="proc_resultado_rm_cns_libros">
		<result property="total" column="total" javaType="double"/>
	</resultMap>
	
	<resultMap class="java.util.HashMap" id="ro_obtener_porcentaje">
		<result property="periodo" column="periodo" javaType="String"/>
		<result property="comercial" column="comercial" javaType="double"/>
		<result property="minorista" column="minorista" javaType="double"/>
		<result property="montoComercial" column="monto_comercial" javaType="double"/>
		<result property="montoMinorista" column="monto_minorista" javaType="double"/>
	</resultMap>
	
	<procedure id="proc_detalle_c04_activo_fijo" parameterClass="java.util.HashMap" resultMap="detalle_c04" >
	  {CALL proc_detalle_c04_activo_fijo(#periodo#)}
	</procedure>
	
	<procedure id="proc_detalle_c04_caja" parameterClass="java.util.HashMap" resultMap="detalle_c04" >
	  {CALL proc_detalle_c04_caja(#periodo#)}
	</procedure>
	
	<procedure id="proc_detalle_c04_intangibles" parameterClass="java.util.HashMap" resultMap="detalle_c04" >
	  {CALL proc_detalle_c04_intangibles(#periodo#)}
	</procedure>
	

	<procedure id="proc_detalle_c04_impuestos" parameterClass="java.util.HashMap" resultMap="detalle_c04" >
	  {CALL proc_detalle_c04_impuestos(#periodo#)}
	</procedure>
	
	<procedure id="proc_detalle_c04_divisas" parameterClass="java.util.HashMap" resultMap="detalle_c04" >
	  {CALL proc_detalle_c04_divisas(#periodo#)}
	</procedure>
	
	<procedure id="proc_detalle_c04_otros" parameterClass="java.util.HashMap" resultMap="detalle_c04" >
	  {CALL proc_detalle_c04_otros(#periodo#)}
	</procedure>

	<procedure id="proc_input_qis_final" parameterClass="java.util.HashMap" resultClass="java.util.HashMap" >
	  {CALL proc_input_qis_final(#periodo#)}
	</procedure>
	<!-- FIN QIS FASE 2 SEGUNDA ETAPA -->
	
		<!-- INVERSIONES Y DERIVADOS -->
		
	<procedure id="proc_resultado_rm_cns_libros" parameterClass="java.util.HashMap" resultMap="proc_resultado_rm_cns_libros" >
	  {CALL proc_resultado_rm_cns_libros(#periodo#,#libro#,#tipoInstrumento#,#tipoContraparte#,#tramos#)}
	</procedure>	
		<!-- FIN INVERSIONES Y DERIVADOS -->
	<resultMap id="resultado_proc_mitigado_deudor" class="java.util.HashMap">
         <result property="tipoDeudor" javaType="String" column="tipo_deudor"/>
         <result property="totalMitigado" javaType="Double" column="total_mitigado"/>
         <result property="totalSinMitigar" javaType="Double" column="total_sin_mitigar"/>  
    </resultMap>

    <procedure id="proc_mitigado_deudor" parameterClass="java.util.HashMap" resultClass="java.util.HashMap" resultMap ="resultado_proc_mitigado_deudor">
	  {CALL proc_mitigado_deudor(#periodo#)}
	</procedure>

	<resultMap class="java.util.HashMap" id="rating_cliente">
		<result property="rut" column="rut" javaType="String"/>
		<result property="razonSocial" column="razon_social" javaType="String"/>
		<result property="empresaUno" column="empresa_clasificadora_1" javaType="String"/>
		<result property="ratingUno" column="rating_1" javaType="String"/>
		<result property="empresaDos" column="empresa_clasificadora_2" javaType="String"/>
		<result property="ratingDos" column="rating_2" javaType="String"/>
		<result property="empresaTres" column="empresa_clasificadora_3" javaType="String"/>
		<result property="ratingTres" column="rating_3" javaType="String"/>
	</resultMap>

	<procedure id="proc_obtener_rating_cliente" parameterClass="java.util.HashMap" resultMap="rating_cliente" >
	  {CALL proc_obtener_rating_cliente(#rut#,#periodo#)}
	</procedure>
	
	<procedure id="proc_guardar_rating_cliente" parameterClass="java.util.HashMap" resultMap="rating_cliente" >
	  {CALL proc_guardar_rating_cliente(#periodo#,#EmpresaClasificada1#,#EmpresaClasificada2#,#EmpresaClasificada3#,#Rating1#,#Rating2#,#Rating3#,#rut#)}
	</procedure>
	
	<resultMap class="java.util.HashMap" id="ro_obtenerInforme">
		<result property="banca" column="banca" javaType="String"/>
		<result property="saldo_hipotecario" column="saldo_hipotecario" javaType="double"/>
		<result property="saldo_tarjeta_credito" column="saldo_tarjeta_credito" javaType="double"/>
		<result property="saldo_linea_sobregiro" column="saldo_linea_sobregiro" javaType="double"/>
		<result property="saldo_credito_consumo" column="saldo_credito_consumo" javaType="double"/>
		<result property="saldo_credito_comercial" column="saldo_credito_comercial" javaType="double"/>
		<result property="saldo_total_montos_credito" column="saldo_total_montos_credito" javaType="double"/>
		<result property="intereses_por_cobrar" column="intereses_por_cobrar" javaType="double"/>
		<result property="saldo_contingentes" column="linea_no_utilizada" javaType="double"/>
		<result property="filial_miami" column="filial_miami" javaType="double"/>
		<result property="filial_leasing" column="filial_leasing" javaType="double"/>
		<result property="filial_factoring" column="filial_factoring" javaType="double"/>
		<result property="intermedio" column="intermedio" javaType="double"/>
		<result property="total_comercial" column="total_comercial" javaType="double"/>
		<result property="total_minorista" column="total_minorista" javaType="double"/>
		<result property="ventas_uf" column="ventas_uf" javaType="double"/>
		<result property="periodo" column="periodo" javaType="double"/>
	</resultMap>
	
	<resultMap class="java.util.HashMap" id="ro_obtener_porcentaje">
		<result property="periodo" column="periodo" javaType="String"/>
		<result property="comercial" column="comercial" javaType="double"/>
		<result property="minorista" column="minorista" javaType="double"/>
		<result property="montoComercial" column="monto_comercial" javaType="double"/>
		<result property="montoMinorista" column="monto_minorista" javaType="double"/>
	</resultMap>
	

	
	<procedure id="proc_ro_obtenerInforme" parameterClass="java.util.HashMap" resultMap="ro_obtenerInforme" >
	  {CALL proc_ro_obtenerInforme(#periodo#)}
	</procedure>
	
		<procedure id="proc_ro_obtener_porcentajes" parameterClass="java.util.HashMap" resultMap="ro_obtener_porcentaje" >
	  {CALL proc_ro_obtener_porcentajes(#periodo#)}
	</procedure>
	

	<procedure id="proc_ro_porcentaje_informe" parameterClass="java.util.HashMap" resultClass="java.util.HashMap" >
	  {CALL proc_ro_porcentaje_informe(#periodo#)}
	</procedure>
	
	<procedure id="actualizar_estados_semaforo" parameterClass="java.util.HashMap" resultClass="java.util.HashMap" >
	  {CALL sp_upd_estado_procesos}
	</procedure>

	<resultMap class="java.util.HashMap" id="rm_procesos_ejecutados">
		<result property="semaforo" column="semaforo" javaType="String"/>
	</resultMap>

	<procedure id="consulta_procesos_en_ejecucion" parameterClass="java.util.HashMap" resultMap="rm_procesos_ejecutados" >
	  {CALL sp_cns_procesos_ejecutados}
	</procedure>

	<resultMap class="java.util.HashMap" id="rm_ingresar_parametros">
		<result property="fecha" column="fecha" javaType="String"/>
	</resultMap>

	<procedure id="ingresar_parametros" parameterClass="java.util.HashMap" resultMap="rm_ingresar_parametros" >
	  {CALL sp_ins_parametros(#periodo#, #tolerancia#, #dolar#, #factor#, #uf#, <isNotNull property="usuario">#usuario#</isNotNull><isNull property="usuario">NULL</isNull>, #proceso#)}
	</procedure>

	<procedure id="iniciar_procesos" parameterClass="java.util.HashMap">
	  {CALL sp_ins_procesos(#periodo#, <isNotNull property="usuario">#usuario#</isNotNull><isNull property="usuario">NULL</isNull>, #proceso#)}
	</procedure>

	<resultMap class="java.util.HashMap" id="rm_estado_sub_procesos">
		<result property="procesoUno" column="procesoUno" javaType="String"/>
		<result property="procesoDos" column="procesoDos" javaType="String"/>
		<result property="procesoTres" column="procesoTres" javaType="String"/>
	</resultMap>

	<procedure id="consultar_sub_procesos" parameterClass="java.util.HashMap" resultMap="rm_estado_sub_procesos" >
	  {CALL sp_cns_sub_procesos(#proceso#)}
	</procedure>

	<resultMap class="java.util.HashMap" id="rm_estado_log_procesos">
		<result property="periodo" column="periodo" javaType="String"/>
		<result property="proceso" column="proceso" javaType="String"/>
		<result property="fecha" column="fecha" javaType="String"/>
		<result property="descripcion" column="descripcion" javaType="String"/>
	</resultMap>

	<procedure id="consultar_log_procesos" parameterClass="java.util.HashMap" resultMap="rm_estado_log_procesos" >
	  {CALL sp_cns_log_procesos(#proceso#)}
	</procedure>

	<resultMap class="java.util.HashMap" id="rm_consultar_estado_procesos">
		<result property="fechaInicio" column="fecha_inicio" javaType="String"/>
		<result property="fechaTermino" column="fecha_termino" javaType="String"/>
	</resultMap>

	<procedure id="consultar_estado_procesos" parameterClass="java.util.HashMap" resultMap="rm_consultar_estado_procesos" >
	  {CALL sp_cns_estado_procesos(#proceso#)}
	</procedure>
	
	<resultMap class="java.util.HashMap" id="rm_consultar_parametros">
		<result property="periodo"					column="periodo" javaType="String"/>
		<result property="tolerancia"				column="tolerancia" javaType="String"/>
		<result property="valorDolar"				column="valor_dolar" javaType="String"/>
		<result property="factor"					column="factor" javaType="String"/>
		<result property="valorUF"					column="valor_uf" javaType="String"/>
		<result property="fechaUltimaModificacion"	column="fecha_ult_modif" javaType="Date"/>
		<result property="procesoRelacionado"		column="proceso" javaType="String"/>
	</resultMap>

	<procedure id="consultar_parametros" parameterClass="java.util.HashMap" resultMap="rm_consultar_parametros" >
	  {CALL sp_cns_parametros(#proceso#)}
	</procedure>
	
</sqlMap>

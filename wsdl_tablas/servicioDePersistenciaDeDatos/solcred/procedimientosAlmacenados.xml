<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
    
<sqlMap namespace="solcred.procedimientosAlmacenados">

	<resultMap id="resultadoRechazoCliente"	class="java.util.HashMap">
			<result property="resultado"		column="existe_rechazo"/>
	</resultMap>
	
	<resultMap id="ejecutivo" class="java.util.HashMap">
        <result property="idEjecutivo"  javaType="String"   column="idEjecutivo"    jdbcType="varchar" />
        <result property="nombre"       javaType="String"   column="nombre"         jdbcType="varchar" />
    </resultMap> 

	<resultMap id="ejecutivoCan" class="java.util.HashMap">
        <result property="idEjecutivo"  javaType="String"   column="idEjecutivo"    jdbcType="varchar" />
        <result property="nombre"       javaType="String"   column="nombre"         jdbcType="varchar" />
    </resultMap>

    <!-- WorkFlow Solicitudes -->
    <resultMap id="destinatariosSolicitud" class="java.util.HashMap">
        <result property="accion"           javaType="String"   column="accion"         jdbcType="varchar"  />
        <result property="rol_origen"       javaType="String"   column="rol_origen"     jdbcType="varchar"  />
        <result property="rol_destino"      javaType="String"   column="rol_destino"    jdbcType="varchar"  />
        <result property="puerta_origen"    javaType="String"   column="puerta_origen"  jdbcType="varchar"  />
        <result property="cargo_destino"    javaType="String"   column="cargo_destino"  jdbcType="varchar"  />
        <result property="estado_origen"    javaType="int"      column="estado_origen"  jdbcType="int"      />
        <result property="estado_destino"   javaType="int"      column="estado_destino" jdbcType="int"      />
        <result property="userid_destino"   javaType="String"   column="userid_destino" jdbcType="varchar"  />
        <result property="nombre_destino"   javaType="String"   column="nombre_destino" jdbcType="varchar"  />
    </resultMap>
    
        <!-- Fin WorkFlow Solicitudes -->
    
    <!-- WorkFlow Solicitudes CAN-->
    <resultMap id="destinatariosSolicitudCan" class="java.util.HashMap">
        <result property="accion"           javaType="String"   column="accion"         jdbcType="varchar"  />
        <result property="rol_origen"       javaType="String"   column="rol_origen"     jdbcType="varchar"  />
        <result property="rol_destino"      javaType="String"   column="rol_destino"    jdbcType="varchar"  />
        <result property="puerta_origen"    javaType="String"   column="puerta_origen"  jdbcType="varchar"  />
        <result property="cargo_destino"    javaType="String"   column="cargo_destino"  jdbcType="varchar"  />
        <result property="estado_origen"    javaType="int"      column="estado_origen"  jdbcType="int"      />
        <result property="estado_destino"   javaType="int"      column="estado_destino" jdbcType="int"      />
        <result property="userid_destino"   javaType="String"   column="userid_destino" jdbcType="varchar"  />
        <result property="nombre_destino"   javaType="String"   column="nombre_destino" jdbcType="varchar"  />
    </resultMap>
    
<!-- Fin WorkFlow Solicitudes CAN-->
    
   	<!-- REEMPLAZOS EJECUTIVOS -->
	<resultMap id="listaEjecutivos" class="java.util.HashMap">
        <result property="usr_id"         	javaType="String"     column="usr_id"                jdbcType="varchar" />        
    </resultMap>
    <resultMap id="listaCargos" class="java.util.HashMap">
        <result property="tms_clv"         	javaType="String"     column="tms_clv"                jdbcType="varchar" />
        <result property="tms_gls"         	javaType="String"     column="tms_gls"                jdbcType="varchar" />        
    </resultMap>
	<!-- FIN REEMPLAZOS EJECUTIVOS -->
	
	<!-- REEMPLAZOS PARA SUC -->
	<resultMap id="respuestaReemplazo" class="java.util.HashMap">
        <result property="respuesta" javaType="int" column="respuesta"   jdbcType="int" />
    </resultMap>
    <resultMap id="respuestaEliminacionReemplazo" class="java.util.HashMap">
        <result property="respuesta" javaType="int" column="respuesta"   jdbcType="int" />
    </resultMap>
	<!-- FIN REEMPLAZOS PARA SUC -->
    

	<!-- REEMPLAZO EJECUTIVOS -->
	<procedure id="obtenerEjecutivosReemplazo" resultMap="listaEjecutivos" parameterClass="java.util.HashMap">
        {CALL sp_con_usr_sol }
    </procedure>
    	<procedure id="obtenerCargosEjecutivos" resultMap="listaCargos" parameterClass="java.util.HashMap">
        {CALL sp_con_tms (#cargo#) }
    </procedure>
	<!-- FIN REEMPLAZOS EJECUTIVOS -->
	
	<procedure id="consultarRechazoCliente" parameterClass="java.util.HashMap" resultMap="resultadoRechazoCliente">
		{CALL proc_cns_rech_sol(#rut_cli#,#dv#,#und_tmp#)}
	</procedure>
	
	<procedure id="obtenerEjecutivosRiesgo" resultMap="ejecutivo" parameterClass="java.util.HashMap">
        {CALL sp_solicitud_cns_eje_rieg }
    </procedure>

	<procedure id="obtenerEjecutivosCan" resultMap="ejecutivoCan" parameterClass="java.util.HashMap">
        {CALL sp_solicitud_cns_eje_can }
    </procedure>

    <!-- WorkFlow Solicitudes -->
    <procedure id="gestionarCicloSolicitud" resultMap="destinatariosSolicitud" parameterClass="java.util.HashMap">
        {CALL sp_solicitud_gestionar_ciclo (
            #userid_ejec#,
            #accion#,
            #estado_act_sol#,
            #oficina#,
            #userid_origen_sol#,
            #nro_solicitud#
        )}
    </procedure>
    <!-- Fin WorkFlow Solicitudes -->

    <!-- WorkFlow Solicitudes CAN-->
    <procedure id="gestionarCicloSolicitudCan" resultMap="destinatariosSolicitudCan" parameterClass="java.util.HashMap">
        {CALL sp_solicitud_gest_ciclo_can (
            #userid_ejec#,
            #accion#,
            #estado_act_sol#,
            #oficina#,
            #userid_origen_sol#,
            #nro_solicitud#,
            #userid_can#
        )}
    </procedure>
    <!-- Fin WorkFlow Solicitudes  CAN-->

    <!-- Consulta cargo Ejecutivo -->
    <resultMap id="cargoEjeSolcred" class="java.util.HashMap">
        <result property="codigo_cargo"    javaType="String"    column="codigo_cargo"    jdbcType="varchar"/>
    </resultMap>

    <procedure id="consultaCargoEjeSolcred" resultMap="cargoEjeSolcred" parameterClass="java.util.HashMap">
        {CALL sp_solicitud_cns_usr_car (
            #id_ejecutivo#
        )}
    </procedure>
    <!-- Fin Consulta cargo Ejecutivo -->

    <!-- Insertar Ejecutivo Riesgo -->
    <procedure id="ingresarEjecutivoRiesgoSol" parameterClass="java.util.HashMap">
        {CALL sp_solicitud_ins_ejec_riesgo (
            #nro_solicitud#,
            #id_estado_destino#,
            #id_ejecutivo#,
            #usuario_creador#,
            <isNotNull property="accion">#accion#</isNotNull><isNull property="accion">NULL</isNull>
        )}
    </procedure>
    <!-- Fin Insertar Ejecutivo Riesgo -->
    <!-- Consulta Perspectiva Pyme-->  
	<resultMap id="resultado"	class="java.util.HashMap">
			<result property="perspectiva"	    column="perspectiva"/>
	</resultMap>

    <procedure id="consultarPerspectivaCliente" parameterClass="java.util.HashMap" resultMap="resultado">
        {CALL sp_cns_perspectiva_pyme( #rutCliente# )}
    </procedure>
    <!-- Consulta Perspectiva Pyme-->  

    <!-- Reemplazos para SUC -->
    
    <procedure id="ingresarReemplazo" parameterClass="java.util.HashMap" resultMap="respuestaReemplazo">
        {CALL sp_ing_rmp_sol (#eje_rmp#, #car_eje_rmp#, #ofi_eje_rmp#, #fec_ini_rmp#, #fec_fin_rmp#, #eje_ori#, #car_eje_ori#,#ofi_eje_ori#)}
    </procedure>
        <procedure id="verificarEliminarReemplazo" parameterClass="java.util.HashMap" resultMap="respuestaEliminacionReemplazo">
        {CALL sp_vfc_rmp_sol (#eje_rmp#,#eje_ori#,#fec_ini#)}
    </procedure>
    <procedure id="eliminarReemplazo" parameterClass="java.util.HashMap" resultMap="respuestaEliminacionReemplazo">
        {CALL sp_del_rmp_sol (#eje_rmp#,#eje_ori#,#fec_ini_rmp#)}
    </procedure>

    <!-- FIN Reemplazos para SUC -->

    <resultMap id="respuestaObtenerJefesOficina" class="java.util.HashMap">
        <result property="usr_id"         	javaType="String"  column="usr_id"              jdbcType="varchar" />
        <result property="usr_ofi"         	javaType="int"     column="usr_ofi"                jdbcType="int" />
    </resultMap>

     <procedure id="obtener_jefes_oficina" parameterClass="java.util.HashMap" resultMap="respuestaObtenerJefesOficina">
        {CALL sp_con_eje (#tipoUsuario#,#oficina#)}
    </procedure>
    
    <resultMap id="ejecutivosPorCargo" class="java.util.HashMap">
        <result property="idEjecutivo"  javaType="String"   column="idEjecutivo"    jdbcType="varchar" />
        <result property="nombre"       javaType="String"   column="nombre"         jdbcType="varchar" />
    </resultMap>

    <procedure id="obtenerEjecutivosPorCargo" resultMap="ejecutivosPorCargo" parameterClass="java.util.HashMap" >
        {CALL sp_solicitud_cns_eje_car (
        <isNotNull property="cargoEjecutivo">#cargoEjecutivo#</isNotNull><isNull property="cargoEjecutivo">cargoEjecutivo</isNull>,
        <isNotNull property="codigoEjecutivo">#codigoEjecutivo#</isNotNull><isNull property="codigoEjecutivo">codigoEjecutivo</isNull>,
        <isNotNull property="codigoFiltroEjecutivo">#codigoFiltroEjecutivo#</isNotNull><isNull property="codigoFiltroEjecutivo">codigoFiltroEjecutivo</isNull>
        )}
    </procedure>
    
    <resultMap id="ejecutivosPorCargoRegional" class="java.util.HashMap">
        <result property="idEjecutivo"  javaType="String"   column="idEjecutivo"    jdbcType="varchar" />
        <result property="nombre"       javaType="String"   column="nombre"         jdbcType="varchar" />
    </resultMap>

    <procedure id="obtenerEjecutivosPorCargoRegional" resultMap="ejecutivosPorCargoRegional" parameterClass="java.util.HashMap" >
        {CALL sp_solicitud_cns_eje_car_reg (
        <isNotNull property="cargoEjecutivo">#cargoEjecutivo#</isNotNull><isNull property="cargoEjecutivo">cargoEjecutivo</isNull>,
        <isNotNull property="codigoEjecutivo">#codigoEjecutivo#</isNotNull><isNull property="codigoEjecutivo">codigoEjecutivo</isNull>,
        <isNotNull property="codigoRegional">#codigoRegional#</isNotNull><isNull property="codigoRegional">codigoRegional</isNull>,
        <isNotNull property="codigoFiltroEjecutivo">#codigoFiltroEjecutivo#</isNotNull><isNull property="codigoFiltroEjecutivo">codigoFiltroEjecutivo</isNull>
        )}
    </procedure>
    
    <resultMap id="destinatariosSolicitudPyme" class="java.util.HashMap">
        <result property="accion"           javaType="String"   column="accion"         jdbcType="varchar"  />
        <result property="rol_origen"       javaType="String"   column="rol_origen"     jdbcType="varchar"  />
        <result property="rol_destino"      javaType="String"   column="rol_destino"    jdbcType="varchar"  />
        <result property="puerta_origen"    javaType="String"   column="puerta_origen"  jdbcType="varchar"  />
        <result property="cargo_destino"    javaType="String"   column="cargo_destino"  jdbcType="varchar"  />
        <result property="estado_origen"    javaType="int"      column="estado_origen"  jdbcType="int"      />
        <result property="estado_destino"   javaType="int"      column="estado_destino" jdbcType="int"      />
        <result property="userid_destino"   javaType="String"   column="userid_destino" jdbcType="varchar"  />
        <result property="nombre_destino"   javaType="String"   column="nombre_destino" jdbcType="varchar"  />
        <result property="tipo_flujo"       javaType="String"   column="tipo_flujo"     jdbcType="varchar"  />
    </resultMap>

    <procedure id="gestionarCicloSolicitudPyme" resultMap="destinatariosSolicitudPyme" parameterClass="java.util.HashMap">
        {CALL sp_solicitud_gest_ciclo_pyme (
            #userid_ejec#,
            #accion#,
            #estado_act_sol#,
            #oficina#,
            #userid_origen_sol#,
            #nro_solicitud#,
            #flagNormaliza#,
            #ult_normaliza#
        )}
    </procedure>

    <resultMap id="ejecutivoRiesgo" class="java.util.HashMap">
        <result property="codigoEjecutivo"           javaType="String"   column="id_ejecutivo"  jdbcType="varchar"  />
        <result property="cargoEjecutivo"           javaType="String"   column="cargo_ejecutivo"  jdbcType="varchar"  />
    </resultMap>

    <procedure id="consultarEjecutivoRiesgoSol" resultMap="ejecutivoRiesgo" parameterClass="java.util.HashMap">
        {CALL sp_solicitud_cns_ejec_riesgo (
            #nro_solicitud#
        )}
    </procedure>

     <procedure id="actualizarFlagWorkflow" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
        {CALL sp_solicitud_upt_flg_work (#nroSolicitud#,#accion#,#id_ejecutivo#)}
    </procedure>

   <!-- Obtiene ultima solicitud -->

    <resultMap class="java.util.HashMap" id="resultadoObtenerUltimaSolcred">
        <result property="numero_solicitud" javaType="long" column="numero_solicitud"/>
        <result property="fecha"            javaType="Date" column="fecha"/>
    </resultMap>

    <procedure id="obtenerUltimaSolcred" parameterClass="java.util.HashMap" resultMap="resultadoObtenerUltimaSolcred">
        {CALL sp_cns_ultima_solcred(#rut_cliente#)}
    </procedure>

    <!-- Fin obtiene ultima solicitud -->
<procedure id="comparaOficinaCentro" parameterClass="java.util.HashMap" resultClass="int">
        {CALL sp_cns_oficina_centro (#oficina#,#oficinaSolicitante#)}
    </procedure>

    <resultMap id="respuestaRegionalUsuario" class="java.util.HashMap">
        <result property="usr_reg"         	javaType="String"  column="usr_reg"              jdbcType="varchar" />
    </resultMap>

     <procedure id="obtenerRegionalUsuario" parameterClass="java.util.HashMap" resultMap="respuestaRegionalUsuario">
        {CALL sp_cns_reg_usr (#codigoEjecutivo#)}
    </procedure>
    
     <procedure id="consultarEjecutivoRiesgoRetail" resultClass="java.util.HashMap" parameterClass="java.util.HashMap" >
            {CALL sp_sol_cns_ejec_rgo_retail(#nro_solicitud#)}
    </procedure>
</sqlMap>    

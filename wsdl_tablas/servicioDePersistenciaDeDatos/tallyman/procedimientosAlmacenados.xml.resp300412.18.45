<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="tallyman.procedimientosAlmacenados">



<resultMap id="resultado_activities" class="java.util.HashMap">
		<result property="numeroOperacionOriginal"     javaType="String"          column="nro_de_operacion_original"/>
		<result property="fecha"					   javaType="String"  column="fecha"/>
		<result property="hora"						   javaType="String"  column="hora"/>
		<result property="nombreActividad"             javaType="String"          column="nombre_actividad"/>
		<result property="usuario"                     javaType="String"          column="usuario"/>
		<result property="nota"                        javaType="String"          column="nota"/>
		<result property="fechaCompromiso"             javaType="java.util.Date"  column="fecha_compromiso"/>
		<result property="resultadoAcuerdo"            javaType="String"          column="resultado_acuerdo"/>
    </resultMap>


<resultMap id="resultado_bycustomer" class="java.util.HashMap">
		<result property="rut"			   javaType="String"          column="rut"/>
		 <result property="ejecutivo"      javaType="String"          column="ejecutivo"/>
		 <result property="tipoDeudor"     javaType="String"          column="tipo_deudor"/>
		 <result property="montoDeuda"      javaType="long"            column="saldo_mora"/>
		 <result property="saldoInsoluto"  javaType="long"            column="saldo_insoluto"/>
		 <result property="diasMora"     javaType="long"            column="dias_de_mora"/>
		 <result property="subbanca"       javaType="String"          column="subbanca"/> 
    </resultMap>

<resultMap id="resultado_byexecutive" class="java.util.HashMap">
         <result property="nombre"           javaType="String"          column="ejecutivo"/>
		 <result property="montoMora"          javaType="long"          column="saldo_mora"/>
		 <result property="saldoInsoluto"      javaType="long"          column="saldo_insoluto"/>
		 <result property="deudoresDirectos"     javaType="long"          column="nro_de_deudores"/> 
    </resultMap>


<resultMap id="resultado_byproduct" class="java.util.HashMap">
	<result property="nombre"       javaType="String"          column="producto"/>
	 <result property="montoDeuda"     javaType="long"          column="saldo_mora"/>
	 <result property="saldoInsoluto"     javaType="long"          column="saldo_insoluto"/>
	 <result property="cantidadDeudores"     javaType="int"          column="nro_de_deudores"/>
	 <result property="cantidadEjecutivos"     javaType="int"          column="nro_de_ejecutivos"/> 
 </resultMap>

<resultMap id="resultado_operation" class="java.util.HashMap">
		<result property="idOperacion"     javaType="String"          column="nro_de_operacion_original"/>
		 <result property="oficina"                     javaType="String"          column="sucursal"/>
		 <result property="producto"                     javaType="String"          column="producto"/>
		 <result property="estadoCobranza"                       javaType="String"          column="estado"/>
		 <result property="montoDeuda"                javaType="long"            column="saldo_mora"/>
		 <result property="saldoInsoluto"               javaType="long"            column="saldo_insoluto"/>
		 <result property="fechaVigencia"            javaType="java.util.Date"  column="fecha_vencimiento"/>
		 <result property="legal"                        javaType="String"          column="legal"/> 
 </resultMap>

<resultMap id="resultado_provisions" class="java.util.HashMap">
	<result property="total"     javaType="long"          column="provisiones"/>
</resultMap>

<resultMap id="resultado_customer" class="java.util.HashMap">
		<result property="rut"                          javaType="String"          column="rut"/>
		 <result property="ejecutivo"                   javaType="String"          column="ejecutivo"/>
		 <result property="subbanca"                    javaType="String"          column="subbanca"/>
		 <result property="total"     javaType="long"          column="provisiones_del_cliente"/> 
 </resultMap>


	<parameterMap id="param_activities" class="java.util.Map">
      	<parameter property="i_rut" mode="IN" jdbcType="BIGINT"/>
		<parameter property="i_cedente" mode="IN" jdbcType="VARCHAR" nullValue="null" />
		<parameter property="weak_cursor" jdbcType="ORACLECURSOR" javaType="java.sql.ResultSet" mode="OUT" />
	</parameterMap>

	<procedure id="activities" parameterMap="param_activities" resultMap="resultado_activities" >
		{CALL nml_everest.activities(?, ?, ?)}
	</procedure>




	<parameterMap id="param_bycustomer" class="java.util.Map">
		<parameter property="i_cedente" mode="IN" jdbcType="VARCHAR" nullValue="null" />
		<parameter property="i_ejecutivo" mode="IN" jdbcType="VARCHAR" nullValue="null" />
		<parameter property="i_producto" mode="IN" jdbcType="VARCHAR" nullValue="null" />
		<parameter property="i_oficina" mode="IN" jdbcType="VARCHAR" nullValue="null" />
		<parameter property="weak_cursor" jdbcType="ORACLECURSOR" javaType="java.sql.ResultSet" mode="OUT" />
	</parameterMap>

	<procedure id="bycustomer"
		parameterMap="param_bycustomer" resultMap ="resultado_bycustomer">
		{CALL nml_everest.bycustomer(
			?, ?, ?, ?, ?
		)}
	</procedure>



        <parameterMap id="param_byexecutive" class="java.util.Map">
		<parameter property="i_cedente" mode="IN" jdbcType="VARCHAR" nullValue="null" />
		<parameter property="i_producto" mode="IN" jdbcType="VARCHAR" nullValue="null" />
		<parameter property="i_oficina" mode="IN"  jdbcType="VARCHAR" nullValue="null" />
		<parameter property="weak_cursor" jdbcType="ORACLECURSOR" javaType="java.sql.ResultSet" mode="OUT" />
	</parameterMap>

	<procedure id="byexecutive"
		parameterMap="param_byexecutive" resultMap ="resultado_byexecutive">
		{CALL nml_everest.byexecutive(
			?, ?, ?, ?
		)}
	</procedure>


        <parameterMap id="param_byproduct" class="java.util.Map">
		<parameter property="i_cedente" mode="IN"  jdbcType="VARCHAR" nullValue="null" />
		<parameter property="i_ejecutivo" mode="IN" jdbcType="VARCHAR" nullValue="null" />
		<parameter property="i_oficina" mode="IN"  jdbcType="VARCHAR" nullValue="null" />
		<parameter property="weak_cursor" jdbcType="ORACLECURSOR" javaType="java.sql.ResultSet" mode="OUT" />
	</parameterMap>

	<procedure id="byproduct"
		parameterMap="param_byproduct" resultMap ="resultado_byproduct">
		{CALL nml_everest.byproduct(
			?, ?, ?, ?
		)}
	</procedure>



	<parameterMap id="param_customer" class="java.util.Map">
		<parameter property="i_rut" mode="IN" jdbcType="BIGINT"/>
		<parameter property="weak_cursor" jdbcType="ORACLECURSOR" javaType="java.sql.ResultSet" mode="OUT" />
	</parameterMap>

	<procedure id="customer"
		parameterMap="param_customer" resultMap ="resultado_customer">
		{CALL nml_everest.customer(
			?, ?
		)}
	</procedure>

	<parameterMap id="param_operation" class="java.util.Map">
		<parameter property="i_rut" mode="IN"  jdbcType="BIGINT"/>
		<parameter property="i_cedente" mode="IN" jdbcType="VARCHAR" nullValue="null" />
		<parameter property="weak_cursor" jdbcType="ORACLECURSOR" javaType="java.sql.ResultSet" mode="OUT" />
	</parameterMap>

	<procedure id="operation"
		parameterMap="param_operation" resultMap ="resultado_operation">
		{CALL nml_everest.operation(
			?, ?, ?
		)}
	</procedure>

	<parameterMap id="param_provisions" class="java.util.Map">
		<parameter property="i_cedente" mode="IN" jdbcType="VARCHAR" nullValue="null" />
		<parameter property="i_ejecutivo" mode="IN" jdbcType="VARCHAR" nullValue="null" />
		<parameter property="i_oficina" mode="IN" jdbcType="VARCHAR" nullValue="null" />
		<parameter property="weak_cursor" jdbcType="ORACLECURSOR" javaType="java.sql.ResultSet" mode="OUT" />
	</parameterMap>

	<procedure id="provisions"
		parameterMap="param_provisions" resultMap ="resultado_provisions">
		{CALL nml_everest.provisions(
			?, ?, ?, ?
		)}
	</procedure>

</sqlMap>

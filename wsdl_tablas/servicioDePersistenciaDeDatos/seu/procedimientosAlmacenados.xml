<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="ctl.procedimientosAlmacenados">

<!-- Inicio AAdvantage -->
    <resultMap id="getObtenerInformacionClientePorRut" class="java.util.HashMap">
        <result property="rutCliente"       column="CLIENTE_RUT"            jdbcType="INT"      javaType="java.lang.Integer" />
        <result property="dvCliente"        column="CLIENTE_DV"             jdbcType="VARCHAR"  javaType="String" />
        <result property="nombres"          column="CLIENTE_NOMBRE"         jdbcType="VARCHAR"  javaType="String" />
        <result property="apellidos"        column="CLIENTE_APELLIDO"       jdbcType="VARCHAR"  javaType="String" />
        <result property="ciudad"           column="CLIENTE_CIUDAD"         jdbcType="VARCHAR"  javaType="String" />
        <result property="direccion"        column="CLIENTE_DIRECCION"      jdbcType="VARCHAR"  javaType="String" />
        <result property="email"            column="CLIENTE_MAIL"           jdbcType="VARCHAR"  javaType="String" />
        <result property="fonoCelular"      column="CLIENTE_FONO_CELULAR"   jdbcType="VARCHAR"  javaType="String" />
        <result property="fonoComercial"    column="CLIENTE_FONO_COMERCIAL" jdbcType="VARCHAR"  javaType="String" />
        <result property="fonoPersonal"     column="CLIENTE_FONO_PERSONAL"  jdbcType="VARCHAR"  javaType="String" />
    </resultMap>
    <parameterMap id="setObtenerInformacionClientePorRut" class="java.util.HashMap">
        <parameter property="rutCliente"    jdbcType="INT"  javaType="java.lang.Integer"/>
        <parameter property="dvCliente"     jdbcType="CHAR" javaType="String" />
    </parameterMap>
    <procedure id="obtenerInformacionClientePorRut" parameterMap="setObtenerInformacionClientePorRut"
        resultMap="getObtenerInformacionClientePorRut">
        { CALL sp_obt_info_cli_por_rut(?,?) }
    </procedure>

    <parameterMap id="setObtenerInformacionClienteEnrolPorRut" class="java.util.HashMap">
        <parameter property="rutCliente"    jdbcType="INT"  javaType="java.lang.Integer"/>
        <parameter property="dvCliente"     jdbcType="CHAR" javaType="String" />
    </parameterMap>
	<resultMap id="getObtenerInformacionClienteEnrolPorRut" class="java.util.HashMap">
        <result property="rutCliente"       column="CLIENTE_RUT"            jdbcType="INT"      javaType="java.lang.Integer" />
        <result property="dvCliente"        column="CLIENTE_DV"             jdbcType="VARCHAR"  javaType="String" />
        <result property="nombres"          column="CLIENTE_NOMBRE"         jdbcType="VARCHAR"  javaType="String" />
        <result property="apellidos"        column="CLIENTE_APELLIDO"       jdbcType="VARCHAR"  javaType="String" />
        <result property="ciudad"           column="CLIENTE_CIUDAD"         jdbcType="VARCHAR"  javaType="String" />
        <result property="direccion"        column="CLIENTE_DIRECCION"      jdbcType="VARCHAR"  javaType="String" />
        <result property="email"            column="CLIENTE_MAIL"           jdbcType="VARCHAR"  javaType="String" />
        <result property="fonoCelular"      column="CLIENTE_FONO_CELULAR"   jdbcType="VARCHAR"  javaType="String" />
        <result property="fonoComercial"    column="CLIENTE_FONO_COMERCIAL" jdbcType="VARCHAR"  javaType="String" />
        <result property="fonoPersonal"     column="CLIENTE_FONO_PERSONAL"  jdbcType="VARCHAR"  javaType="String" />
        <result property="fechaApertura"    column="CLIENTE_FECHA_APERTURA" jdbcType="DATE"     javaType="java.util.Date" />
    </resultMap>
    <procedure id="obtenerInformacionClienteEnrolPorRut" parameterMap="setObtenerInformacionClienteEnrolPorRut"
        resultMap="getObtenerInformacionClienteEnrolPorRut">
        { CALL sp_obt_info_enrol_cli_por_rut(?,?) }
    </procedure>
    
    <resultMap id="getObtenerInformacionClientePorMemberId" class="java.util.HashMap">
        <result property="rutCliente"       column="CLIENTE_RUT"            jdbcType="INT"      javaType="java.lang.Integer" />
        <result property="dvCliente"        column="CLIENTE_DV"             jdbcType="VARCHAR"  javaType="String" />
        <result property="nombres"          column="CLIENTE_NOMBRE"         jdbcType="VARCHAR"  javaType="String" />
        <result property="apellidos"        column="CLIENTE_APELLIDO"       jdbcType="VARCHAR"  javaType="String" />
        <result property="ciudad"           column="CLIENTE_CIUDAD"         jdbcType="VARCHAR"  javaType="String" />
        <result property="direccion"        column="CLIENTE_DIRECCION"      jdbcType="VARCHAR"  javaType="String" />
        <result property="email"            column="CLIENTE_MAIL"           jdbcType="VARCHAR"  javaType="String" />
        <result property="fonoCelular"      column="CLIENTE_FONO_CELULAR"   jdbcType="VARCHAR"  javaType="String" />
        <result property="fonoComercial"    column="CLIENTE_FONO_COMERCIAL" jdbcType="VARCHAR"  javaType="String" />
        <result property="fonoPersonal"     column="CLIENTE_FONO_PERSONAL"  jdbcType="VARCHAR"  javaType="String" />
    </resultMap>
    <parameterMap id="setObtenerInformacionClientePorMemberId"  class="java.util.HashMap">
        <parameter property="memberId"     jdbcType="VARCHAR" javaType="String" />
    </parameterMap>
    <procedure id="obtenerInformacionClientePorMemberId" parameterMap="setObtenerInformacionClientePorMemberId"
        resultMap="getObtenerInformacionClientePorMemberId">
        { CALL sp_obt_info_cli_por_mmbid(?) }
    </procedure>

    <resultMap id="getObtenerMemberIdsPorRut" class="java.util.HashMap">
        <result property="memberId" column="MEMBER_ID" jdbcType="VARCHAR"  javaType="String" />
    </resultMap>
    <parameterMap id="setObtenerMemberIdsPorRut"  class="java.util.HashMap">
        <parameter property="rutCliente"    jdbcType="INT"  javaType="java.lang.Integer"/>
        <parameter property="dvCliente"     jdbcType="CHAR" javaType="String" />
    </parameterMap>
    <procedure id="obtenerMemberIdsPorRut" parameterMap="setObtenerMemberIdsPorRut" resultMap="getObtenerMemberIdsPorRut">
        { CALL sp_obt_mmbid_por_rut(?,?) }
    </procedure>

    <resultMap id="getFacturacionMillasPorRut" class="java.util.HashMap">
        <result property="rut"              column="RUT"                jdbcType="INT"      javaType="String" />
        <result property="dv"               column="DV"                 jdbcType="CHAR"     javaType="String" />
        <result property="memberId"         column="MEMBER_ID"          jdbcType="VARCHAR"  javaType="String" />
        <result property="participantId"    column="PARTICIPANT_ID"     jdbcType="VARCHAR"  javaType="String" />
        <result property="pcan"             column="CLIENTE_PCAN"       jdbcType="VARCHAR"  javaType="String" />
        <result property="periodoBilling"   column="FACTURACION_FECHA"  jdbcType="DATE"     javaType="java.util.Date" />
        <result property="producto"         column="PRODUCTO"           jdbcType="VARCHAR"  javaType="String" />
        <result property="pst"              column="PST"                jdbcType="VARCHAR"  javaType="String" />
        <result property="usoPst"           column="PST_USO"            jdbcType="VARCHAR"  javaType="String" />
        <result property="millas"           column="MILLAS"             jdbcType="INT"      javaType="String" />
        <result property="indicadorMillas"  column="INDICADOR_MILLAS"   jdbcType="VARCHAR"  javaType="String" />
        <result property="periodoPago"      column="PERIODO_PAGO"       jdbcType="DATE"     javaType="java.util.Date" />
    </resultMap>
    <parameterMap id="setFacturacionMillasPorRut"  class="java.util.HashMap">
        <parameter property="rutCliente"    jdbcType="INT"  javaType="java.lang.Integer"/>
        <parameter property="dvCliente"     jdbcType="CHAR" javaType="String" />
    </parameterMap>
    <procedure id="obtenerFacturacionMillasPorRut" parameterMap="setFacturacionMillasPorRut" resultMap="getFacturacionMillasPorRut">
        { CALL sp_obt_fact_mill_por_rut(?,?) }
    </procedure>
    
    <resultMap id="getFacturacionMillasPorMemberId" class="java.util.HashMap">
        <result property="rut"              column="RUT"                jdbcType="INT"      javaType="String" />
        <result property="dv"               column="DV"                 jdbcType="CHAR"     javaType="String" />
        <result property="memberId"         column="MEMBER_ID"          jdbcType="VARCHAR"  javaType="String" />
        <result property="participantId"    column="PARTICIPANT_ID"     jdbcType="VARCHAR"  javaType="String" />
        <result property="pcan"             column="CLIENTE_PCAN"       jdbcType="VARCHAR"  javaType="String" />
        <result property="periodoBilling"   column="FACTURACION_FECHA"  jdbcType="DATE"     javaType="java.util.Date" />
        <result property="producto"         column="PRODUCTO"           jdbcType="VARCHAR"  javaType="String" />
        <result property="pst"              column="PST"                jdbcType="VARCHAR"  javaType="String" />
        <result property="usoPst"           column="PST_USO"            jdbcType="VARCHAR"  javaType="String" />
        <result property="millas"           column="MILLAS"             jdbcType="INT"      javaType="String" />
        <result property="indicadorMillas"  column="INDICADOR_MILLAS"   jdbcType="VARCHAR"  javaType="String" />
        <result property="periodoPago"      column="PERIODO_PAGO"       jdbcType="DATE"     javaType="java.util.Date" />
    </resultMap>
    <parameterMap id="setFacturacionMillasPorMemberId"  class="java.util.HashMap">
        <parameter property="memberId"      jdbcType="VARCHAR" javaType="String" />
    </parameterMap>
    <procedure id="obtenerFacturacionMillasPorMemberId" parameterMap="setFacturacionMillasPorMemberId" resultMap="getFacturacionMillasPorMemberId">
        { CALL sp_obt_fact_mill_por_mmbid(?) }
    </procedure>

    <resultMap id="getObtenerEnrolamientoCierreCuentasPorRut" class="java.util.HashMap">
        <result property="rutCliente"           column="CLIENTE_RUT"        jdbcType="INT"      javaType="java.lang.Integer" />
        <result property="dvCliente"            column="CLIENTE_DV"         jdbcType="VARCHAR"  javaType="String" />
        <result property="codigoRechazo"        column="CODIGO_RECHAZO"     jdbcType="VARCHAR"  javaType="String" />
        <result property="descripcionRechazo"   column="DESC_RECHAZO"       jdbcType="VARCHAR"  javaType="String" />
        <result property="diasEnvio"            column="NUM_DIAS"           jdbcType="INT"      javaType="java.lang.Integer" />
        <result property="estado"               column="ESTADO_ACT_CUENTA"  jdbcType="VARCHAR"  javaType="String" />
        <result property="fechaEnvio"           column="FECHA_ENVIO"        jdbcType="DATE"     javaType="java.util.Date" />
        <result property="fechaEstado"          column="FECHA_ESTADO_ACT"   jdbcType="DATE"     javaType="java.util.Date" />
        <result property="memberId"             column="MEMBER_ID"          jdbcType="VARCHAR"  javaType="String" />
        <result property="nombreRechazo"        column="NOMBRE_RECHAZO"     jdbcType="VARCHAR"  javaType="String" />
        <result property="nroTarjeta"           column="NUMERO_OPERACION"   jdbcType="VARCHAR"  javaType="String" />
        <result property="pcan"                 column="PCAN"               jdbcType="VARCHAR"  javaType="String" />
        <result property="producto"             column="NOMBRE_PRODUCTO"    jdbcType="VARCHAR"  javaType="String" />
    </resultMap>
    <parameterMap id="setObtenerEnrolamientoCierreCuentasPorRut" class="java.util.HashMap">
        <parameter property="rutCliente"    jdbcType="INT"  javaType="java.lang.Integer"/>
        <parameter property="dvCliente"     jdbcType="CHAR" javaType="String" />
    </parameterMap>
    <procedure id="obtenerEnrolamientoCierreCuentasPorRut" parameterMap="setObtenerEnrolamientoCierreCuentasPorRut"
        resultMap="getObtenerEnrolamientoCierreCuentasPorRut">
        { CALL sp_obt_enrol_por_rut(?,?) }
    </procedure>

    <resultMap id="getObtenerEnrolamientoCierreCuentasPorMemberId" class="java.util.HashMap">
        <result property="rutCliente"           column="CLIENTE_RUT"        jdbcType="INT"      javaType="java.lang.Integer" />
        <result property="dvCliente"            column="CLIENTE_DV"         jdbcType="VARCHAR"  javaType="String" />
        <result property="codigoRechazo"        column="CODIGO_RECHAZO"     jdbcType="VARCHAR"  javaType="String" />
        <result property="descripcionRechazo"   column="DESC_RECHAZO"       jdbcType="VARCHAR"  javaType="String" />
        <result property="diasEnvio"            column="NUM_DIAS"           jdbcType="INT"      javaType="java.lang.Integer" />
        <result property="estado"               column="ESTADO_ACT_CUENTA"  jdbcType="VARCHAR"  javaType="String" />
        <result property="fechaEnvio"           column="FECHA_ENVIO"        jdbcType="DATE"     javaType="java.util.Date" />
        <result property="fechaEstado"          column="FECHA_ESTADO_ACT"   jdbcType="DATE"     javaType="java.util.Date" />
        <result property="memberId"             column="MEMBER_ID"          jdbcType="VARCHAR"  javaType="String" />
        <result property="nombreRechazo"        column="NOMBRE_RECHAZO"     jdbcType="VARCHAR"  javaType="String" />
        <result property="nroTarjeta"           column="NUMERO_OPERACION"   jdbcType="VARCHAR"  javaType="String" />
        <result property="pcan"                 column="PCAN"               jdbcType="VARCHAR"  javaType="String" />
        <result property="producto"             column="NOMBRE_PRODUCTO"    jdbcType="VARCHAR"  javaType="String" />
    </resultMap>
    <parameterMap id="setObtenerEnrolamientoCierreCuentasPorMemberId" class="java.util.HashMap">
        <parameter property="memberId"     jdbcType="VARCHAR" javaType="String" />
    </parameterMap>
    <procedure id="obtenerEnrolamientoCierreCuentasPorMemberId" parameterMap="setObtenerEnrolamientoCierreCuentasPorMemberId"
        resultMap="getObtenerEnrolamientoCierreCuentasPorMemberId">
        { CALL sp_obt_enrol_por_mmbid(?) }
    </procedure>

    <resultMap id="getCuentasUnificadas" class="java.util.HashMap">
        <result property="rut"              	column="CLIENTE_RUT"            jdbcType="INT"      javaType="java.lang.Integer" />
        <result property="dv"               	column="CLIENTE_DV"             jdbcType="CHAR"     javaType="java.lang.String" />
        <result property="nroTarjeta"       	column="NUMERO_OPERACION"       jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="producto"         	column="PST_PRODUCTO"          	jdbcType="VARCHAR"  javaType="java.lang.String" />
        <result property="pcan"             	column="cliente_pcan"           jdbcType="CHAR"     javaType="java.lang.String" />
        <result property="fechaActualizacion"  	column="cliente_merge_fecha"	jdbcType="DATE"     javaType="java.util.Calendar" typeHandler="cl.bci.middleware.aplicacion.persistencia.handler.CalendarTypeHandler" />
        <result property="memberIdAnterior"     column="cliente_id_desde"       jdbcType="CHAR"     javaType="java.lang.String" />
        <result property="memberIdActual"       column="cliente_id"             jdbcType="CHAR"     javaType="java.lang.String" />
    </resultMap>
    
    <parameterMap id="setCuentasUnificadasPorRut"  class="java.util.HashMap">
        <parameter property="rutCliente"    jdbcType="INT"  javaType="java.lang.Integer"/>
        <parameter property="dvCliente"     jdbcType="CHAR" javaType="String" />
    </parameterMap>
    <procedure id="obtenerCuentasUnificadasPorRut" parameterMap="setCuentasUnificadasPorRut" resultMap="getCuentasUnificadas">
        { CALL sp_obt_ctas_unificadas_por_rut(?, ?) }
    </procedure>
    
    <parameterMap id="setCuentasUnificadasPorMemberId"  class="java.util.HashMap">
        <parameter property="memberId"    jdbcType="CHAR"  javaType="String"/>
    </parameterMap>
    <procedure id="obtenerCuentasUnificadasPorMemberId" parameterMap="setCuentasUnificadasPorMemberId" resultMap="getCuentasUnificadas">
        { CALL sp_obt_ctas_unificadas_por_mbr(?) }
    </procedure>

    <resultMap id="getObtenerMillasAcumuladasPorRut" class="java.util.HashMap">
        <result property="rutCliente"           column="CLIENTE_RUT"            jdbcType="INT"      javaType="String" />
        <result property="dvCliente"            column="CLIENTE_DV"             jdbcType="VARCHAR"  javaType="String" />
        <result property="pcan"                 column="PCAN"                   jdbcType="VARCHAR"  javaType="String" />
        <result property="nroOperacion"         column="NUMERO_OPERACION"       jdbcType="VARCHAR"  javaType="String" />
        <result property="producto"             column="NOMBRE_PRODUCTO"        jdbcType="VARCHAR"  javaType="String" />
        <result property="millasAcumuladas"     column="CANTIDAD_MILLAS"        jdbcType="INT"      javaType="String" />
        <result property="fechaEnvio"           column="FECHA_ENVIO_MILLAS"     jdbcType="DATE"     javaType="java.util.Date" />
        <result property="memberId"             column="MEMBER_ID"              jdbcType="VARCHAR"  javaType="String" />
        <result property="pst"                  column="PST"                    jdbcType="VARCHAR"  javaType="String" />
        <result property="estado"               column="ESTADO_ACT_POSTING"     jdbcType="VARCHAR"  javaType="String" />
        <result property="codigoRechazo"        column="CODIGO_RECHAZO"         jdbcType="VARCHAR"  javaType="String" />
        <result property="nombreRechazo"        column="NOMBRE_RECHAZO"         jdbcType="VARCHAR"  javaType="String" />
        <result property="descripcionRechazo"   column="DESCRIPCION_RECHAZO"    jdbcType="VARCHAR"  javaType="String" />
        <result property="fechaEstado"          column="FECHA_ESTADO_ACT_CTA"   jdbcType="DATE"     javaType="java.util.Date" />
        <result property="diasEnvio"            column="NUM_DIAS"               jdbcType="INT"      javaType="String" />
    </resultMap>
    <parameterMap id="setObtenerMillasAcumuladasPorRut" class="java.util.HashMap">
        <parameter property="rutCliente"    jdbcType="INT"  javaType="java.lang.Integer"/>
        <parameter property="dvCliente"     jdbcType="CHAR" javaType="String" />
    </parameterMap>
    <procedure id="obtenerMillasAcumuladasPorRut" parameterMap="setObtenerMillasAcumuladasPorRut"
        resultMap="getObtenerMillasAcumuladasPorRut">
        { CALL sp_obt_mill_acum_por_rut(?,?) }
    </procedure>

    <resultMap id="getObtenerMillasAcumuladasPorMemberId" class="java.util.HashMap">
        <result property="rutCliente"           column="CLIENTE_RUT"            jdbcType="INT"      javaType="String" />
        <result property="dvCliente"            column="CLIENTE_DV"             jdbcType="VARCHAR"  javaType="String" />
        <result property="pcan"                 column="PCAN"                   jdbcType="VARCHAR"  javaType="String" />
        <result property="nroOperacion"         column="NUMERO_OPERACION"       jdbcType="VARCHAR"  javaType="String" />
        <result property="producto"             column="NOMBRE_PRODUCTO"        jdbcType="VARCHAR"  javaType="String" />
        <result property="millasAcumuladas"     column="CANTIDAD_MILLAS"        jdbcType="INT"      javaType="String" />
        <result property="fechaEnvio"           column="FECHA_ENVIO_MILLAS"     jdbcType="DATE"     javaType="java.util.Date" />
        <result property="memberId"             column="MEMBER_ID"              jdbcType="VARCHAR"  javaType="String" />
        <result property="pst"                  column="PST"                    jdbcType="VARCHAR"  javaType="String" />
        <result property="estado"               column="ESTADO_ACT_POSTING"     jdbcType="VARCHAR"  javaType="String" />
        <result property="codigoRechazo"        column="CODIGO_RECHAZO"         jdbcType="VARCHAR"  javaType="String" />
        <result property="nombreRechazo"        column="NOMBRE_RECHAZO"         jdbcType="VARCHAR"  javaType="String" />
        <result property="descripcionRechazo"   column="DESCRIPCION_RECHAZO"    jdbcType="VARCHAR"  javaType="String" />
        <result property="fechaEstado"          column="FECHA_ESTADO_ACT_CTA"   jdbcType="DATE"     javaType="java.util.Date" />
        <result property="diasEnvio"            column="NUM_DIAS"               jdbcType="INT"      javaType="String" />
    </resultMap>
    <parameterMap id="setObtenerMillasAcumuladasPorMemberId" class="java.util.HashMap">
        <parameter property="memberId"     jdbcType="VARCHAR" javaType="String" />
    </parameterMap>
    <procedure id="obtenerMillasAcumuladasPorMemberId" parameterMap="setObtenerMillasAcumuladasPorMemberId"
        resultMap="getObtenerMillasAcumuladasPorMemberId">
        { CALL sp_obt_mill_acum_por_mmbid(?) }
    </procedure>
<!-- Fin AAdvantage -->

<parameterMap id="setIngresarCampana"       class="java.util.HashMap">
        <parameter property="cliente_rut"       jdbcType="NUMERIC" javaType="java.lang.Integer"/>
        <parameter property="cliente_dv"        jdbcType="CHAR" javaType="java.lang.String" />
        <parameter property="campagna_id"       jdbcType="VARCHAR" javaType="java.lang.String" />
        <parameter property="tiene_tarjeta_aa"  jdbcType="VARCHAR" javaType="java.lang.String" />
        <parameter property="member_id"         jdbcType="VARCHAR" javaType="java.lang.String" />
        <parameter property="cliente_mail"      jdbcType="VARCHAR" javaType="java.lang.String" />    
    </parameterMap>
    
    <procedure id="ingresarCampana" parameterMap="setIngresarCampana" >
        {CALL sp_ins_camp (?, ?, ?, ?, ?, ?)}
    </procedure>

</sqlMap>

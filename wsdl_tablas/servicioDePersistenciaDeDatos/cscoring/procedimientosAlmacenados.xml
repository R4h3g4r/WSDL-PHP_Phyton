<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
    
<sqlMap namespace="cscoring.procedimientosAlmacenados">


    <resultMap id="listadoHistoricoFN"    class="java.util.HashMap">
            <result property="fechaIngreso"        column="rcz_fec_ing"    />
            <result property="fuente"            column="rcz_fte_inf"    />
            <result property="motivo"            column="mrz_des_mot"    />
            <result property="semaforo"            column="mrz_smf"        />
    </resultMap>
    
    <resultMap id="reglaTasaRiesgo"    class="java.util.HashMap">
            <result property="calificacion"        column="id_calificacion"    />
            <result property="regla"            column="regla"    />
            <result property="tasa"            column="t_riesgo"    />
    </resultMap>
    
    <resultMap id="tasaRiesgo"    class="java.util.HashMap">
            <result property="tasaRiesgo"            column="t_riesgo"    />
    </resultMap>

    <resultMap id="MapObtenerCodigosFileNegativoCliente" class="java.util.HashMap">
        <result property="codigoMotivo" column="mrz_cod_mot"/>
    </resultMap>

    <procedure id="guardarEventoFileNegativo" parameterClass="java.util.HashMap">
        {CALL proc_guardar_evt_file_neg(#rut#,#dv#,#cod_motivo#,#glosa_ext_idc#,#fuente#)}
    </procedure>
    
    <procedure id="guardarHistoricoFileNegativo" parameterClass="java.util.HashMap">
        {CALL proc_historico_file_neg(#rut#,#cod_motivo#)}
    </procedure>
    
    <procedure id="obtenerHistoricoFileNegativo" parameterClass="java.util.HashMap" resultMap="listadoHistoricoFN	">
        {CALL proc_cns_fn_hist(#rut#)}
    </procedure>
    
    <procedure id="consultarReglasTasaRiesgo" parameterClass="java.util.HashMap" resultMap="reglaTasaRiesgo">
        {CALL proc_cns_reg_triesgo()}
    </procedure>
    
    <procedure id="consultarTasaRiesgoCliente" parameterClass="java.util.HashMap" resultMap="tasaRiesgo">
        {CALL proc_cns_tasa_riesgo(#rut#)}
    </procedure>
    
    <procedure id="actualizarReglasTasasDeRiesgo" parameterClass="java.util.HashMap">
        {CALL proc_act_reg_triesgo(#id_calificacion#,#regla#,#tasa#)}
    </procedure>

    <procedure id="obtenerCodigosFileNegativoCliente" parameterClass="java.util.HashMap" resultMap="MapObtenerCodigosFileNegativoCliente">
        {CALL sp_cns_rcz(#rut#)}
    </procedure>

    <procedure id="actualizarFiltrosFileNegativoCliente" parameterClass="java.util.HashMap">
        {CALL sp_proc_file_neg(#rut#,#dv#,#motivos#,#acciones#,#glosa_ext_idc#,#fuente#)}
    </procedure>
    
    <procedure id="almacenarIndicadoresScoreDeBuro" parameterClass="java.util.HashMap">
        {CALL sp_sbr_ing_val(#rut#,#dv#,#sburo#,#triesgo#)}
    </procedure>

    <!-- Ocupacion Cliente -->
    
    <resultMap id="resultadoOcupacion" class="java.util.HashMap">
        <result property="ocupacion"  javaType="String"   jdbcType="varchar"/>
    </resultMap>

    <procedure id="consultarOcupacion" parameterClass="java.util.HashMap" resultMap="resultadoOcupacion">
        {CALL sp_cns_ocupacion( #situacionLaboral#, #actividad#, #profesion# )}
    </procedure>
    
    <!-- Ocupacion Cliente -->
    
    <!-- Fecha negativa mas reciente -->
    
    <resultMap id="resultadoFecha"    class="java.util.HashMap">
            <result property="resultado"        column="fec_eve_eng"    />
    </resultMap>

    <procedure id="consultarFechaNegativa" parameterClass="java.util.HashMap" resultMap="resultadoFecha">
        {CALL sp_con_fng_fec( #rut#, #dv# )}
    </procedure>
    
    <!-- Fecha negativa mas reciente -->
    
   <!-- Consulta Clientes en lista de observacion -->
    
    <resultMap id="resultado"    class="java.util.HashMap">
            <result property="cod_fil_neg"        column="cod_fil_neg"/>
            <result property="ind_sev"            column="ind_sev"/>
            <result property="ind_fil_neg"        column="ind_fil_neg"/>
    </resultMap>

    <procedure id="consultarListaObservacion" parameterClass="java.util.HashMap" resultMap="resultado">
        {CALL sp_con_flt_rsg( #rutCliente# )}
    </procedure>
    
    <!-- Fecha negativa mas reciente -->
    
    <resultMap id="getTraeFactoresPonderacion" class="java.util.HashMap">
        <result property="tms_sci" column="tms_sci" jdbcType="VARCHAR" javaType="String"/>
        <result property="tms_clv" column="tms_clv" jdbcType="VARCHAR" javaType="String"/>
        <result property="tms_val" column="tms_val" jdbcType="VARCHAR" javaType="String"/>
        <result property="tms_gls" column="tms_gls" jdbcType="VARCHAR" javaType="String"/>
    </resultMap>
    <procedure id="traeFactoresPonderacion" resultMap="getTraeFactoresPonderacion">
        { CALL sp_get_crg_prp }
    </procedure>
    
    <resultMap id="respuestaCliAcogidoALeyDeQuiebra" class="java.util.HashMap">
        <result property="respuesta" javaType="String" column="respuesta"   jdbcType="varchar" />
    </resultMap>
    
     <procedure id="consultarCliAcogidoALeyDeQuiebra" parameterClass="java.util.HashMap" resultMap="respuestaCliAcogidoALeyDeQuiebra">
        {CALL sp_con_cli_con_ley_quiebra (#rut#,#codigoCondicion#,#codMotivo#)}
    </procedure>      
    
    <!-- Obtener Filtro de Riesgo Lob -->
    <resultMap class="java.util.HashMap" id="resultadoObtenerFiltroRiesgo">
        <result property="motivo"      column="mrz_cod_mot"/>
        <result property="fecha"      column="rcz_fec_ing"/>
        <result property="indicador"      column="mrz_smf"/>
    </resultMap>
     <procedure id="obtenerFiltroRiesgo" parameterClass="java.util.HashMap" resultMap="resultadoObtenerFiltroRiesgo">
        {CALL sp_con_rcz( #rut# )}
    </procedure>
    <!-- Fin  Obtener Filtro de Riesgo Lob-->
    <parameterMap id="setProtestoMemoria" class="java.util.HashMap">
        <parameter property="rut"             jdbcType="INTEGER" javaType="java.lang.Long" />
    </parameterMap>

    <procedure id="consultaProtestoMemoria" parameterMap="setProtestoMemoria" resultClass="int">
        {CALL sp_con_protestoMemoria (?)}
    </procedure>    
    
    <parameterMap id="setGrabaCalificacion" class="java.util.HashMap">
        <parameter property="idc"     jdbcType="CHAR" javaType="String" />
        <parameter property="vrf"     jdbcType="CHAR" javaType="String" />
        <parameter property="cnl"     jdbcType="CHAR" javaType="String" />
        <parameter property="cls"     jdbcType="CHAR" javaType="String" />
    </parameterMap>

    <procedure id="grabaCalificacion" parameterMap="setGrabaCalificacion">
        {CALL sp_ing_cls (?,?,?,?)}
    </procedure>   
    
    
    <parameterMap id="setConsultaRechazo" class="java.util.HashMap">
        <parameter property="rut"            jdbcType="CHAR" javaType="String" />
    </parameterMap>

    <resultMap id="getConsultaRechazo" class="java.util.HashMap">
        <result property="descripcion"        jdbcType="CHAR"       javaType="String" />
        <result property="fechaIngreso"       jdbcType="CHAR"       javaType="String" />
        <result property="indicador"          jdbcType="INTEGER"    javaType="int" />
    </resultMap>

    <procedure id="consultaRechazo" parameterMap="setConsultaRechazo" resultMap="getConsultaRechazo">
        {CALL sp_con_rcz (?)}
    </procedure>   
    
    
    <resultMap id="getFileNegativoVisacion" class="java.util.HashMap">
        <result property="descripcion"      column="des_mot"  jdbcType="CHAR"      javaType="String" />
        <result property="fechaIngreso"     column="fec_ing"  jdbcType="CHAR"      javaType="String" />
        <result property="fuente"           column="des_fuente"  jdbcType="CHAR"      javaType="String" />
        <result property="indicador"        column="semaforo"  jdbcType="SMALLINT"  javaType="Integer" />
    </resultMap>
    
    <parameterMap id="setFileNegativoVisacion" class="java.util.HashMap">
        <parameter property="rut"            jdbcType="CHAR" javaType="String" />
    </parameterMap>

    <procedure id="fileNegativoVisacion" parameterMap="setFileNegativoVisacion" resultMap="getFileNegativoVisacion">
        {CALL sp_con_vis (?)}
    </procedure>   
    
</sqlMap>    

<?xml version="1.0" encoding="UTF-8" ?>
 
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
	
<sqlMap namespace="clusterop.procedimientosAlmacenados">
	<resultMap id="obtenerDatosDiv" class="java.util.HashMap">
		<result property="bciOperacionId" column="bci_operacion_chip_id" javaType="String"/>
		<result property="numOperacion" column="num_operacion_chip" javaType="String"/>
		<result property="rutCliente" column="rut_cliente" javaType="String"/>
		<result property="dv" column="dv" javaType="String"/>
		<result property="nombre" column="nombre" javaType="String"/>
		<result property="fechaEscritura" column="fecha_escritura" javaType="java.util.Date" />
		<result property="producto" column="producto" javaType="String"/>
		<result property="objetivo" column="objetivo" javaType="String"/>
		<result property="totalDividendos" column="total_dividendos" javaType="java.lang.Integer"/>
		<result property="dividendosGenerados" column="dividendos_generados" javaType="java.lang.Integer"/>
		<result property="dividendosCancelados" column="dividendos_cancelados" javaType="java.lang.Integer"/>
		<result property="saldoInsoluto" column="saldo_insoluto" javaType="String"/>
		<result property="moneda" column="moneda" javaType="String"/>
		<result property="montoCadaDiv" column="monto_cada_dividendo" javaType="String"/>
		<result property="sumaTotalDivCancelados" column="sum_total_div_cancelados" javaType="String"/>
		<result property="fechaUltimoDiv" column="fecha_ultimo_div" javaType="java.util.Date"/>
		<result property="fechaUltimoDivFinalMes" column="fecha_ultimo_div_30" javaType="java.util.Date"/>
		<result property="cae" column="cae" javaType="String"/>
		<result property="ctc" column="ctc" javaType="String"/>
		<result property="dividendosPagar" column="dividendos_pagar" javaType="java.lang.Integer"/>
		<result property="morosidad" column="morosidad" javaType="java.lang.Integer"/>
		<result property="banca" column="banca" javaType="String"/>
		<result property="numeroCuenta" column="numero_cuenta" javaType="String"/>
		<result property="codEstado" column="cod_estado" javaType="java.lang.Integer"/>
		<result property="estado" column="estado" javaType="String"/>
	</resultMap>
	<parameterMap id="consultaDatoDiv" class="java.util.HashMap">
		<parameter property="numOperacion" jdbcType="VARCHAR" javaType="String"/>
	</parameterMap>	
	<procedure id="consulta_dividendo" parameterMap="consultaDatoDiv"
		resultMap="obtenerDatosDiv">
		{ CALL sp_bci_consulta_operacion_chip (?) }
	</procedure>
	<resultMap id="resultado" class="java.util.HashMap">
		<result property="codEstado" column="cod_estado" javaType="java.lang.Integer"/>		
	</resultMap>
	<parameterMap id="datos_insertar" class="java.util.HashMap">
		<parameter property="numOperacion" jdbcType="VARCHAR" javaType="String"/>
		<parameter property="rutCliente" jdbcType="VARCHAR" javaType="String"/>
		<parameter property="dv" jdbcType="VARCHAR" javaType="String"/>
		<parameter property="ejecutivoCliente" jdbcType="VARCHAR" javaType="String"/>
		<parameter property="codSucursal" jdbcType="VARCHAR" javaType="String"/>
		<parameter property="emailCliente" jdbcType="VARCHAR" javaType="String"/>
		<parameter property="emailEjecutivo" jdbcType="VARCHAR" javaType="String"/>
	</parameterMap>	
	<procedure id="inserta_postergado" parameterMap="datos_insertar"
		resultMap="resultado">
		{ CALL sp_bci_insertar_solicitud_chip (?, ?, ?, ?, ?, ?, ?, 0x) }
	</procedure>
	
	<procedure id="consultarDeudaCovid" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
        {CALL sp_bci_consultar_deuda_covid(
        #rut#)}
	</procedure>
	
	<resultMap id="resultado_refi" class="java.util.HashMap">
		<result property="resultado" column="resultado" javaType="java.lang.Integer"/>		
	</resultMap>
	<parameterMap id="dato_refi" class="java.util.HashMap">
		<parameter property="rut" jdbcType="VARCHAR" javaType="String"/>
		<parameter property="dv" jdbcType="VARCHAR" javaType="String"/>
		<parameter property="numeroRefinanciamiento" jdbcType="VARCHAR" javaType="String"/>
		<parameter property="montoRefinanciamiento"  jdbcType="numeric"  	 javaType="Double"/>	
		<parameter property="codigoEstadoRefinanciamiento" jdbcType="INT" javaType="Integer"/>
	</parameterMap>	
	<procedure id="insertarRefinanciamientoCovid" parameterMap="dato_refi" resultMap="resultado_refi">
        {CALL sp_bci_insertar_refinanciamiento_covid(?,?,?,?,?)}
	</procedure>
	
	<resultMap id="resultado_covid" class="java.util.HashMap">
		<result property="resultado" column="resultado" javaType="java.lang.Integer"/>		
	</resultMap>
	<parameterMap id="dato_covid" class="java.util.HashMap">
		<parameter property="rut" jdbcType="VARCHAR" javaType="String"/>
		<parameter property="dv" jdbcType="VARCHAR" javaType="String"/>
		<parameter property="numeroCreditoCovid" jdbcType="VARCHAR" javaType="String"/>
		<parameter property="montoCreditoCovid"  jdbcType="numeric"  	 javaType="Double"/>	
		<parameter property="codigoEstadoCovid" jdbcType="INT" javaType="Integer"/>
	</parameterMap>	

<procedure id="insertCreditoCovid" parameterMap="dato_covid" resultMap="resultado_covid">
        {CALL sp_bci_insertar_credito_covid(?,?,?,?,?)}
	</procedure>	
	<resultMap id="resultSolicitudCreditoCovidRezagado" class="java.util.HashMap">
       <result property="codRetorno" column="cod_retorno" javaType="java.lang.Integer" />  
     </resultMap>
	<parameterMap id="parameterSolicitudCreditoCovidRezagado" class="java.util.HashMap">
		<parameter property="rutCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="dvCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="nombreEmpresa"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="rutApoderado"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="dvApoderado"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="nombreApoderado"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="emailCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="celularCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="emailEjecutivo"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="codBanca"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="afectadoCovid"   	        jdbcType="int"  javaType="java.lang.Integer" />
		<parameter property="mandatoNumerico"   	        jdbcType="int"  javaType="java.lang.Integer" />
		<parameter property="carpetaTributaria"   	        jdbcType="int"  javaType="java.lang.Integer" />
		<parameter property="canal"   	        jdbcType="VARCHAR"  javaType="String"  />
	</parameterMap>
	<procedure id="insertarSolicitudRezagado" parameterMap="parameterSolicitudCreditoCovidRezagado" 
		resultMap="resultSolicitudCreditoCovidRezagado" >
		{ CALL sp_bci_insertar_solicitud_credito_covid_rezagado (?,?,?,?,?,?,?,?,?,?,?,?,?,?)}
	</procedure>
	
	<resultMap id="resultIngresarSolicitudCreditoCovid" class="java.util.HashMap">
       <result property="codRetorno" column="cod_retorno" javaType="java.lang.Integer" />  
     </resultMap>
	<parameterMap id="parameterIngresarSolicitudCreditoCovid" class="java.util.HashMap">
		<parameter property="rutCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="dvCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="nombreEmpresa"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="rutApoderado"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="dvApoderado"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="nombreApoderado"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="emailCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="celularCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="emailEjecutivo"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="codBanca"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="afectadoCovid"   	        jdbcType="int"  javaType="java.lang.Integer" />
		<parameter property="mandatoNumerico"   	        jdbcType="int"  javaType="java.lang.Integer" />
		<parameter property="carpetaTributaria"   	        jdbcType="int"  javaType="java.lang.Integer" />
		<parameter property="canal"   	        jdbcType="VARCHAR"  javaType="String"  />
	</parameterMap>
	<procedure id="insertarSolicitudCreditoCovid" parameterMap="parameterIngresarSolicitudCreditoCovid" 
		resultMap="resultIngresarSolicitudCreditoCovid" >
		{ CALL sp_bci_insertar_solicitud_credito_covid (?,?,?,?,?,?,?,?,?,?,?,?,?,?)}
	</procedure>
	
	 <resultMap id="resultparameterSolicitudCreditoCovid" class="java.util.HashMap">
       <result property="rutCliente" javaType="String" column="rut" jdbcType="VARCHAR"  />  
       <result property="dvCliente"   	        jdbcType="VARCHAR"  column="dv" javaType="String" />
		<result property="nombreEmpresa"   	        jdbcType="VARCHAR" column="nombre_empresa" javaType="String" />
		<result property="rutApoderado"   	        jdbcType="VARCHAR" column="rut_apoderado"  javaType="String" />
		<result property="dvApoderado"   	        jdbcType="VARCHAR" column="dv_apoderado"  javaType="String" />
		<result property="nombreApoderado"   	        jdbcType="VARCHAR" column="nombre_apoderado" javaType="String" />
		<result property="emailCliente"   	        jdbcType="VARCHAR" column="email_cliente"  javaType="String" />
		<result property="celularCliente"   	        jdbcType="VARCHAR" column="celular_cliente" javaType="String" />
		<result property="emailEjecutivo"   	        jdbcType="VARCHAR" column="email_ejecutivo" javaType="String" />
		<result property="codBanca"   	        jdbcType="VARCHAR" column="cod_banca" javaType="String" />
		<result property="afectadoCovid"   	        jdbcType="int" column="afectado_covid" javaType="java.lang.Integer" />
		<result property="mandatoNumerico"   	        jdbcType="int" column="mandato_numerico" javaType="java.lang.Integer" />
		<result property="carpetaTributaria"   	        jdbcType="int" column="carpeta_tributaria" javaType="java.lang.Integer" />
		<result property="canal"   	        jdbcType="VARCHAR" column="canal"  javaType="String"  />
		<result property="bciSolicitudCreditoCovidId"   	        jdbcType="VARCHAR" column="bci_solicitud_credito_covid_id"  javaType="String"  />
		<result property="codEstado"   	        jdbcType="int" column="cod_estado" javaType="java.lang.Integer" />
		<result property="estadoCovid"   	        jdbcType="VARCHAR" column="estado"  javaType="String"  />
		<result property="fechaIngreso" column="fecha_ingreso" javaType="java.util.Date" />
		<result property="fechaModificacionEstado" column="fecha_modificacion_estado" javaType="java.util.Date" />
     </resultMap>
	<parameterMap id="parameterSolicitudCreditoCovid" class="java.util.HashMap">
		<parameter property="rutCliente" jdbcType="VARCHAR"  javaType="String" />
	</parameterMap>
	<procedure id="consultarSolicitudCreditoCovid" parameterMap="parameterSolicitudCreditoCovid" resultMap="resultparameterSolicitudCreditoCovid" >
		{ CALL sp_bci_consultar_solicitud_credito_covid (?)}
	</procedure>
	
	<resultMap id="resultFiltroSolicitudCreditoCovid" class="java.util.HashMap">
		<result property="rutCliente"	column="rut"	jdbcType="VARCHAR" 	 javaType="String" /> 
       	<result property="dvCliente"   	column="dv"     jdbcType="VARCHAR"   javaType="String" />
		<result property="inscripcionCodEstado" column="inscripcion_cod_estado"        jdbcType="int"  javaType="java.lang.Integer" />
		<result property="inscripcionEstado"    column="inscripcion_estado"      jdbcType="VARCHAR"  javaType="String" />
		<result property="filtroCodEstado"   	    column="filtro_cod_estado"     jdbcType="int"  javaType="java.lang.Integer" />
		<result property="filtroEstado"   	   column="filtro_estado"      jdbcType="VARCHAR" javaType="String" />
		<result property="filtroMonto"   	     column="filtro_monto"    jdbcType="DECIMAL"  javaType="java.math.BigDecimal" />        
     </resultMap>
	<parameterMap id="parameterFiltroSolicitudCreditoCovid" class="java.util.HashMap">
		<parameter property="rutCliente" jdbcType="VARCHAR"  javaType="String" />
		<parameter property="dvCliente" jdbcType="VARCHAR"  javaType="String" />
	</parameterMap>
	<procedure id="filtroSolicitudCreditoCovid" parameterMap="parameterFiltroSolicitudCreditoCovid" resultMap="resultFiltroSolicitudCreditoCovid" >
		{ CALL sp_bci_consultar_filtro_covid (?,?)}
	</procedure>
	
	<resultMap id="resultDeudaCreditoCovid" class="java.util.HashMap">
	 	<result property="rutCliente"	column="rut"	jdbcType="VARCHAR" 	 javaType="String" /> 
       	<result property="dvCliente"   	column="dv"     jdbcType="VARCHAR"   javaType="String" />
		<result property="tipoProducto" column="tipo_producto"        jdbcType="VARCHAR"  javaType="String" />
		<result property="numOperacion" column="numero_operacion"      jdbcType="VARCHAR"  javaType="String" />
		<result property="cuotasPorPagar"   	    column="cuotas_por_pagar"     jdbcType="int"  javaType="java.lang.Integer" />
		<result property="moneda"   	   column="moneda"      jdbcType="VARCHAR" javaType="String" />
		<result property="sistema"   	     column="sistema"    jdbcType="VARCHAR"  javaType="String" /> 
		<result property="montoTotalRefinanciar"   	     column="monto_total_refinanciar"    jdbcType="DECIMAL"  javaType="java.math.BigDecimal" />             
     	<result property="cuotasRefinanciar"   	    column="cuotas_refinanciar"     jdbcType="int"  javaType="java.lang.Integer" />
     	<result property="valorCalculo"   	     column="valor_calculo"    jdbcType="DECIMAL"  javaType="java.math.BigDecimal" />             
     </resultMap>
	<parameterMap id="parameterDeudaCreditoCovid" class="java.util.HashMap">
		<parameter property="rutCliente" jdbcType="VARCHAR"  javaType="String" />
	</parameterMap>
	<procedure id="deudaSolicitudCreditoCovid" parameterMap="parameterDeudaCreditoCovid" resultMap="resultDeudaCreditoCovid" >
		{ CALL sp_bci_consultar_deuda_covid (?)}
	</procedure>
	
	<resultMap id="resultRiesgoCreditoCovid" class="java.util.HashMap">
	 	<result property="rutCliente"	column="rut"	jdbcType="VARCHAR" 	 javaType="String" /> 
       	<result property="dvCliente"   	column="dv"     jdbcType="VARCHAR"   javaType="String" />
     	<result property="monto"   	     column="monto"    jdbcType="DECIMAL"  javaType="java.math.BigDecimal" />             
     </resultMap>
	<parameterMap id="parameterRiesgoCreditoCovid" class="java.util.HashMap">
		<parameter property="rutCliente" jdbcType="VARCHAR"  javaType="String" />
	</parameterMap>
	<procedure id="riesgoSolicitudCreditoCovid" parameterMap="parameterRiesgoCreditoCovid" resultMap="resultRiesgoCreditoCovid" >
		{ CALL sp_bci_consultar_monto_covid_riesgo (?)}
	</procedure>
	
	<resultMap id="resultInsertarCreditoCovid" class="java.util.HashMap">
       <result property="codRetorno" javaType="java.lang.Integer" column="resultado" jdbcType="int"  />  
     </resultMap>
	<parameterMap id="parameterInsertarCreditoCovid" class="java.util.HashMap">
		<parameter property="rutCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="dvCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="numOperacion"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="montoOperacion"   	        jdbcType="DECIMAL"  javaType="java.math.BigDecimal" />
		<parameter property="codEstadoCovid"   	        jdbcType="int"  javaType="java.lang.Integer" />
	</parameterMap>
	<procedure id="insertarCreditoCovid" parameterMap="parameterInsertarCreditoCovid" resultMap="resultInsertarCreditoCovid" >
		{ CALL sp_bci_insertar_credito_covid (?,?,?,?,?)}
	</procedure>
	
	<resultMap id="resultInsertarRefinanciamientoCredito" class="java.util.HashMap">
       <result property="codRetorno" javaType="java.lang.Integer" column="resultado" jdbcType="int"  />  
     </resultMap>
	<parameterMap id="parameterInsertarRefinanciamientoCredito" class="java.util.HashMap">
		<parameter property="rutCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="dvCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="numOperacionRefinanciamiento"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="montoOperacionRefinanciamiento"   	        jdbcType="DECIMAL"  javaType="java.math.BigDecimal" />
		<parameter property="codEstadoRefinanciamiento"   	        jdbcType="int"  javaType="java.lang.Integer" />
	</parameterMap>
	<procedure id="insertarRefinanciamientoCreditoCovid" parameterMap="parameterInsertarRefinanciamientoCredito" resultMap="resultInsertarRefinanciamientoCredito" >
		{ CALL sp_bci_insertar_refinanciamiento_covid (?,?,?,?,?)}
	</procedure>
	
	<resultMap id="resultCalculoOperacionCovidCredito" class="java.util.HashMap">
       <result property="codRetorno" javaType="java.lang.Integer" column="resultado" jdbcType="int"  />  
     </resultMap>
	<parameterMap id="parameterCalculoOperacionCovidCredito" class="java.util.HashMap">
		<parameter property="numOperacion"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="valorCalculo"   	        jdbcType="DECIMAL"  javaType="java.math.BigDecimal" />
	</parameterMap>
	<procedure id="calculoOperacionCreditoCovid" parameterMap="parameterCalculoOperacionCovidCredito" resultMap="resultCalculoOperacionCovidCredito" >
		{ CALL sp_bci_actualizar_valor_calculo_operacion_covid (?,?)}
	</procedure>
	
	<resultMap id="resultOperacionCreditoCovid" class="java.util.HashMap">
       <result property="codRetorno" javaType="java.lang.Integer" column="resultado" jdbcType="int"  />  
     </resultMap>
	<parameterMap id="parameterOperacionCreditoCovid" class="java.util.HashMap">
		<parameter property="rutCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="dvCliente"   	        jdbcType="VARCHAR"  javaType="String" />
		<parameter property="codEstado"   	        jdbcType="int"  javaType="java.lang.Integer" />
	</parameterMap>
	<procedure id="cambiarEstadoCreditoCovid" parameterMap="parameterOperacionCreditoCovid" resultMap="resultOperacionCreditoCovid" >
		{ CALL sp_bci_cambio_estado_covid (?,?,?)}
	</procedure>	
	<procedure id="actualizarValorCalculoEverest" resultClass="java.util.HashMap" parameterClass="java.util.HashMap">
        {CALL sp_bci_actualizar_valor_calculo_operacion_everest_covid(
        #numeroDeOperacion#,#valorCalculo#
        )}
	</procedure>	

</sqlMap>
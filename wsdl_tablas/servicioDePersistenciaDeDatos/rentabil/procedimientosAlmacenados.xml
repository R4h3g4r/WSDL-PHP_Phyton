<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
	
<sqlMap namespace="rentabil.procedimientosAlmacenados">

	<resultMap id="getAtributos" class="java.util.HashMap">
		<result property="ren_rut"  					jdbcType="INTEGER" 	javaType="java.lang.Long"/>
		<result property="ren_dv"  						jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_spread"  				jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_cal_ant"      		jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_cal_act"      		jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_mar_brt_int"      	jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_col_int"      		jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_ind_ren"      		jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_per"      			jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_mar_brt_anual"      	jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_ind_ren_anual"      	jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_ini"      			jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_med"      			jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_sup"      			jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_fin"      			jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_mrg_inte"				jdbcType="VARCHAR" 	javaType="java.lang.String"/>
		<result property="ren_des_mrg_inte_ante"		jdbcType="VARCHAR" 	javaType="java.lang.String"/>
	</resultMap>
	
	<parameterMap id="setAtributos" class="java.util.HashMap">
		<parameter property="rut"			jdbcType="INTEGER" javaType="java.lang.Long" />
	</parameterMap>

    <procedure id="rentabilidadCliente" parameterMap="setAtributos" resultMap="getAtributos">
		{CALL sp_cns_ren_cli (?)}
	</procedure>

    <parameterMap id="setDetalleRentabil" class="java.util.HashMap">
        <parameter property="rut"     jdbcType="CHAR" javaType="String" />
    </parameterMap>

    <resultMap id="getDetalleRentabil" class="java.util.HashMap">
        <result property="oficina"              jdbcType="CHAR"     javaType="String"/>
        <result property="cod_linea"            jdbcType="CHAR"     javaType="String"/>
        <result property="des_linea"            jdbcType="CHAR"     javaType="String"/>
        <result property="cant_ope"             jdbcType="INTEGER"  javaType="java.lang.Integer"/>
        <result property="saldo_cierre"         jdbcType="float"    javaType="double" />
        <result property="saldo_promedio"       jdbcType="float"    javaType="double" />
        <result property="intereses"            jdbcType="float"    javaType="double" />
        <result property="ajustes"              jdbcType="float"    javaType="double" />
        <result property="comisiones"           jdbcType="float"    javaType="double" />
        <result property="pool"                 jdbcType="float"    javaType="double" />
        <result property="costos_dir"           jdbcType="float"    javaType="double" />
        <result property="costos_ind"           jdbcType="float"    javaType="double" />
        <result property="margen"               jdbcType="float"    javaType="double" />
    </resultMap>

    <procedure id="detalleRentabilidad" parameterMap="setDetalleRentabil" resultMap="getDetalleRentabil">
        {CALL sp_dev_ren (?)}
    </procedure>

    <parameterMap id="setObtenerRentabilidad" class="java.util.HashMap">
        <parameter property="rut"          jdbcType="CHAR"    javaType="String" />
        <parameter property="periodo1"     jdbcType="INTEGER" javaType="int" />
        <parameter property="periodo2"     jdbcType="INTEGER" javaType="int" />
        <parameter property="periodo3"     jdbcType="INTEGER" javaType="int" />
    </parameterMap>

    <resultMap id="getObtenerRentabilidad" class="java.util.HashMap">
        <result property="rut"              jdbcType="CHAR"     javaType="long" />
        <result property="utilidad"         jdbcType="CHAR"     javaType="double"/>
        <result property="periodo"          jdbcType="CHAR"     javaType="String"/>
        <result property="promedio1"        jdbcType="INTEGER"  javaType="double"/>
        <result property="cantidadMeses1"   jdbcType="INTEGER"  javaType="int"/>
        <result property="promedio2"        jdbcType="INTEGER"  javaType="double"/>
        <result property="cantidadMeses2"   jdbcType="INTEGER"  javaType="int"/>
        <result property="promedio3"        jdbcType="INTEGER"  javaType="double" />
        <result property="cantidadMeses3"   jdbcType="INTEGER"  javaType="int"/>
    </resultMap>

    <procedure id="obtenerRentabilidad" parameterMap="setObtenerRentabilidad" resultMap="getObtenerRentabilidad">
        {CALL sp_obt_inf_ren (?, ?, ?, ?)}
    </procedure>
</sqlMap>

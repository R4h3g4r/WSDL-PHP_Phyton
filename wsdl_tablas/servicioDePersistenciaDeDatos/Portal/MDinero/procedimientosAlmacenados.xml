<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="PortalMDinero.procedimientosAlmacenados">
	
	<parameterMap id="setObtenerContratos" class="java.util.HashMap">
		<parameter property="rutEmpresa" jdbcType="INTEGER"  javaType="java.lang.Long"/>
		<parameter property="rutApoderado" jdbcType="INTEGER"  javaType="java.lang.Long"/>
		<parameter property="estado" jdbcType="CHAR"  javaType="String" />
	</parameterMap>
	<resultMap id="getObtenerContratos" class="java.util.HashMap">
			<result property="idContrato" column="idContrato" javaType="String"/>
			<result property="fechaContrato" column="fechaContrato" javaType="String"/>
			<result property="apoderado" column="apoderado" javaType="String"/>			
	</resultMap>
	<procedure id="obtenerContratos" parameterMap="setObtenerContratos" resultMap="getObtenerContratos">		
	{ CALL sp_cns_con_x_est (?,?,?) }	
	</procedure>
	
	<parameterMap id="setObtenerContratosFirmados" class="java.util.HashMap">
		<parameter property="rutEmpresa" jdbcType="INTEGER"  javaType="java.lang.Long"/>
		<parameter property="rutApoderado" jdbcType="INTEGER"  javaType="java.lang.Long"/>
		<parameter property="estado" jdbcType="CHAR"  javaType="String" />
	</parameterMap>
	<resultMap id="getObtenerContratosFirmados" class="java.util.HashMap">
			<result property="idContrato" column="idContrato" javaType="String"/>
			<result property="fechaContrato" column="fechaContrato" javaType="String"/>
			<result property="apoderado" column="apoderado" javaType="String"/>			
	</resultMap>
	<procedure id="obtenerContratosFirmados" parameterMap="setObtenerContratosFirmados" resultMap="getObtenerContratosFirmados">		
	{ CALL sp_cns_con_fir_est (?,?,?) }	
	</procedure>

	<parameterMap id="setObtenerCondicionesContrato" class="java.util.HashMap">
		<parameter property="idContrato" jdbcType="INTEGER"  javaType="java.lang.Long" />
	</parameterMap>
	<resultMap id="getObtenerCondicionesContrato" class="java.util.HashMap">
		<result property="tipoTransaccion" column="tipoTransaccion" javaType="String"/><!---CCF_TIP_TRX-->
		<result property="fechaPagoContrato" column="fechaPagoContrato" javaType="String"/><!--CCF_FEC_PAG-->
		<result property="vendedor" column="vendedor" javaType="String"/><!--CCF_NOM_VEN-->
		<result property="comprador" column="comprador" javaType="String"/><!--CCF_NOM_COM-->
		<result property="modalidadCumplimiento" column="modalidadCumplimiento" javaType="String"/><!--CCF_MOD_CUM-->
		<result property="tipoMonedaExtranjera" column="tipoMonedaExtranjera" javaType="String"/><!--CCF_MON_EXT_TIP-->
		<result property="montoMonedaExtranjera" column="montoMonedaExtranjera" javaType="java.lang.Double"/><!--CCF_MON_EXT_CAN-->
		<result property="tipoCambioContrato" column="tipoCambioContrato" javaType="String"/><!--CCF_TIP_CAM_CON-->
		<result property="pariadadContrato" column="pariadadContrato" javaType="String"/><!-- CCF_PAR_CON-->
		<result property="precioMonedaPactado" column="precioMonedaPactado" javaType="java.lang.Double"/><!--CCF_PRE_PAC-->
		<result property="tipoCambioReferencial" column="tipoCambioReferencial" javaType="String"/><!-- CCF_TIP_CAM_PRE-->
		<result property="paridadReferencial" column="paridadReferencial" javaType="String"/><!-- CCF_PAR_REF-->
		<result property="bancosReferencia" column="bancosReferencia" javaType="String"/><!--CCF_BCO_REF-->
		<result property="garantia" column="garantia" javaType="String"/><!--CCF_GAR-->
		<result property="formaDePago" column="formaDePago" javaType="String"/><!--CCF_FOR_PAG-->
		<result property="identificadorBancoOrigen" column="identificadorBancoOrigen" javaType="String"/><!--CCF_LUG_CUM -->
		<result property="identificadorBancoDestino" column="identificadorBancoDestino" javaType="String"/><!-- CCF_RUT_CLI-->
		<result property="domicilioBancoOrigen" column="domicilioBancoOrigen" javaType="String"/><!-- CCF_DIR_LEG_BCI-->
		<result property="domicilioCliente" column="domicilioCliente" javaType="String"/><!--CCF_DIR_CLI -->		
		<result property="fechaValuta" column="fechaValuta" javaType="String"/><!-- CCF_VAL_PAG-->
		<result property="ciudadCliente" column="ciudadCliente" javaType="String"/><!-- CCF_CIU_CLI-->
		<result property="codigoTipoContrato" column="codigoTipoContrato" javaType="String"/><!-- No se la tabla ni el campo-->	
		<!-- <result property="observaciones" column="observaciones" javaType="String"/> -->			
	</resultMap>
	<procedure id="obtenerCondicionesContrato" parameterMap="setObtenerCondicionesContrato" resultMap="getObtenerCondicionesContrato">	
		{ CALL sp_cns_cond_con(?) }	
	</procedure>

	<parameterMap id="setEstadoBloqueoContrato" class="java.util.HashMap">
		<parameter property="idContrato" jdbcType="INTEGER"  javaType="java.lang.Long" />
	</parameterMap>
	<resultMap id="getEstadoBloqueoContrato" class="java.util.HashMap">
		<result property="estadoContrato" column="estadoContrato" javaType="String"/><!--bloqueado-->
		<result property="usuarioBloqueaContrato" column="usuarioBloqueaContrato" javaType="String"/><!--nombre Del usuario que bloquea el contrato-->		
	</resultMap>
	<procedure id="estadoBloqueoContrato" parameterMap="setEstadoBloqueoContrato" resultMap="getEstadoBloqueoContrato">	
		{ CALL sp_cns_blq(?) }	
	</procedure>	
	
	<parameterMap id="setDesbloquearContratoUtilizandoUmbral" class="java.util.HashMap">
		<parameter property="idContrato" jdbcType="INTEGER"  javaType="java.lang.Long" />
		<parameter property="umbral" jdbcType="INTEGER"  javaType="java.lang.Double"/>
	</parameterMap>
	<procedure id="desbloquearContratoUtilizandoUmbral" parameterMap="setDesbloquearContratoUtilizandoUmbral" resultClass="int">	
		{ CALL sp_act_des_blq(?,?) }	
	</procedure>	
	
	<parameterMap id="setBloquearContrato" class="java.util.HashMap">
		<parameter property="idContrato" jdbcType="INTEGER"  javaType="java.lang.Long" />
		<parameter property="rutApoderado" jdbcType="INTEGER"  javaType="java.lang.Long"/> <!-- Para desbloquear un contrato debe haber pasado una cantidad de tiempo mayor a un umbral de tiempo en min pasado por parametro -->
	</parameterMap>
	<procedure id="bloquearContrato" parameterMap="setBloquearContrato" resultClass="int">	
		{ CALL sp_ins_blq(?,?) }	
	</procedure>
	
	<parameterMap id="setConsultarPorGeneracionPreviaContrato" class="java.util.HashMap">
		<parameter property="idContrato" jdbcType="INTEGER"  javaType="java.lang.Long" />
	</parameterMap>
	<resultMap id="getConsultarPorGeneracionPreviaContrato" class="java.util.HashMap">
		<result property="estadoContrato" column="estadoContrato" javaType="String"/><!--retorna generado indicando que el contrato ya ha sido generado previamente -->		
	</resultMap>
	<procedure id="consultarPorGeneracionPreviaContrato" parameterMap="setConsultarPorGeneracionPreviaContrato" resultMap="getConsultarPorGeneracionPreviaContrato">	
		{ CALL sp_cns_gen_cto(?) }	
	</procedure>
	
	<parameterMap id="setActualizarEstadoFirma" class="java.util.HashMap">
		<parameter property="idContrato" jdbcType="INTEGER"  javaType="java.lang.Long" />
		<parameter property="rutFirmante" jdbcType="INTEGER"  javaType="java.lang.Long"/>
		<parameter property="dvFirmante"  jdbcType="CHAR"  javaType="String"/>		
		<parameter property="perfil"  jdbcType="CHAR"  javaType="String"/>
	</parameterMap>
	<procedure id="actualizarEstadoFirma" parameterMap="setActualizarEstadoFirma" resultClass="int">	
		{ CALL sp_ins_firm_con(?,?,?,?) }	
	</procedure>
	
	<parameterMap id="setObtenerTipoContrato" class="java.util.HashMap">
		<parameter property="codigoContrato"  jdbcType="CHAR"  javaType="String"/>	
	</parameterMap>
	<resultMap id="getObtenerTipoContrato" class="java.util.HashMap">
			<result property="codigoContrato" column="codigoContrato" javaType="String"/>
			<result property="glosaContrato" column="glosaContrato" javaType="String"/>		
	</resultMap>
	<procedure id="obtenerTipoContrato" parameterMap="setObtenerTipoContrato" resultMap="getObtenerTipoContrato">		
	{ CALL cns_tip_con (?) }	
	</procedure>
	
	<parameterMap id="setObtenerEstadoContrato" class="java.util.HashMap">
		<parameter property="codigoContrato"  jdbcType="CHAR"  javaType="String"/>	
	</parameterMap>
	<resultMap id="getObtenerEstadoContrato" class="java.util.HashMap">
			<result property="codigoEstadoContrato" column="codigoEstadoContrato" javaType="String"/>
			<result property="glosaEstadoContrato" column="glosaEstadoContrato" javaType="String"/>		
	</resultMap>
	<procedure id="obtenerEstadoContrato" parameterMap="setObtenerEstadoContrato" resultMap="getObtenerEstadoContrato">		
	{ CALL cns_tip_est (?) }	
	</procedure>
	
	<parameterMap id="setBuscarContratos" class="java.util.HashMap">
		<parameter property="idContrato" jdbcType="INTEGER"  javaType="java.lang.Long"/>
		<parameter property="fechaInicio" jdbcType="CHAR"  javaType="String" />
		<parameter property="fechaFin" jdbcType="CHAR"  javaType="String" />
		<parameter property="estado" jdbcType="CHAR"  javaType="String" />
		<parameter property="rutEmpresa" jdbcType="INTEGER"  javaType="java.lang.Long"/>
		<parameter property="rutEjecutivo" jdbcType="INTEGER"  javaType="java.lang.Long"/>
		<parameter property="tipoContrato" jdbcType="CHAR"  javaType="String" />
	</parameterMap>
	<resultMap id="getBuscarContratos" class="java.util.HashMap">
			<result property="idContrato" column="idContrato" javaType="String"/>
			<result property="fechaCelebracion" column="fechaCelebracion" javaType="String"/>
			<result property="desTipoContrato" column="desTipoContrato" javaType="String"/>
			<result property="codigoTipoContrato" column="codigoTipoContrato" javaType="String"/>	
			<result property="codigoEstado" column="codigoEstado" javaType="String"/>
			<result property="desEstado" column="desEstado" javaType="String"/>				
			<result property="rutCliente" column="rutCliente" javaType="java.lang.Long"/>
			<result property="dvCliente" column="dvCliente" javaType="String"/>	
			<result property="accion" column="accion" javaType="String"/>	
	</resultMap>
	<procedure id="buscarContratos" parameterMap="setBuscarContratos" resultMap="getBuscarContratos">		
	{ CALL sp_busqueda_contrato (?,?,?,?,?,?,?) }	
	</procedure>
	
	<parameterMap id="setCambiarEstadoContrato" class="java.util.HashMap">
		<parameter property="idContrato" jdbcType="INTEGER"  javaType="java.lang.Long" />
		<parameter property="estadoContrato"  jdbcType="CHAR"  javaType="String"/>	
		<parameter property="rutModifica" jdbcType="INTEGER"  javaType="java.lang.Long"/>		
	</parameterMap>
	<procedure id="cambiarEstadoContrato" parameterMap="setCambiarEstadoContrato" resultClass="int">	
		{ CALL sp_act_est_con(?,?,?) }	
	</procedure>
	
</sqlMap>
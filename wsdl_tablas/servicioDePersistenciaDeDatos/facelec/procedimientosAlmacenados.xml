<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="facelec.procedimientosAlmacenados">
		
       <resultMap id="MapDocumentosFacturados" class="java.util.HashMap">
            <result property="tipo_documento" column="tipo_documento"/>
            <result property="numero_documento"   column="numero_documento"/>
            <result property="fecha_emision"  column="fecha_emision"/>
            <result property="valor_neto"  column="valor_neto"/>
            <result property="valor_exento" column="valor_exento"/>
            <result property="iva"     column="iva"/>
            <result property="total" column="total"/>
            <result property="concepto" column="concepto"/>
        </resultMap>


    <procedure id="consultarDocumentosFacturados" parameterClass="java.util.HashMap" resultMap="MapDocumentosFacturados">
        {CALL proc_consulta_doc_facturados(#folio#,#tipo_doc#,#fecha#,#fecha_inicio#,#fecha_termino#,#id_sucursal#,#rutReceptor#)}
    </procedure>
       <resultMap class="java.util.HashMap" id="detalleFinDiaSalida">
            <result property="folio" javaType="Integer" column="Folio" jdbcType="numeric"/>
            <result property="tipoDoc" javaType="Integer" column="Tipo_doc" jdbcType="numeric"/>
            <result property="fechaEmision" javaType="String" column="Fecha_Emision" jdbcType="varchar"/>
            <result property="rut" javaType="String" column="Rut" jdbcType="varchar"/>
            <result property="razonSocial" javaType="String" column="Razon_Social" jdbcType="varchar"/>
            <result property="direccion" javaType="String" column="Direccion" jdbcType="varchar"/>
            <result property="neto" javaType="Integer" column="Neto" jdbcType="numeric"/>
            <result property="exento" javaType="Integer" column="Exento" jdbcType="numeric"/> 
            <result property="iva" javaType="Integer" column="Iva" jdbcType="numeric"/> 
            <result property="montoFinal" javaType="Integer" column="Monto_Final" jdbcType="numeric"/> 
            <result property="sucDestino" javaType="Integer" column="Suc_Destino" jdbcType="int"/> 
            <result property="sucOrigen" javaType="Integer" column="Suc_Origen" jdbcType="int"/> 
        </resultMap>

        <resultMap class="java.util.HashMap" id="resumenFinDiaSalida">
            <result property="sucDestino" javaType="Integer" column="Suc_Destino" jdbcType="int"/> 
            <result property="fechaEmision" javaType="java.util.Date" column="Fecha_Emision" jdbcType="Date"/>
            <result property="totalMontoFinal" javaType="Integer" column="Total_Monto_Final" jdbcType="numeric"/> 
        </resultMap>

				<!-- sp_cns_det_suc(@sucursal, @tipo) -->
	
	<procedure id="detalleFinDia" parameterClass="java.util.HashMap" resultMap="detalleFinDiaSalida">
	
		{CALL sp_cns_det_suc(#sucursal#,#tipo#)}
		
	</procedure>

				<!-- sp_cns_res_suc(@sucursal, @tipo) -->
	
	<procedure id="resumenFinDia" parameterClass="java.util.HashMap" resultMap="resumenFinDiaSalida">
	
		{CALL sp_cns_res_suc(#sucursal#,#tipo#)}
		
	</procedure>
	
    <resultMap class="java.util.HashMap" id="buscarClienteSalida">
        <result property="codigoCliente" javaType="Long" column="rgc_cod" jdbcType="numeric"/>
        <result property="rut" javaType="Long" column="rgc_rut" jdbcType="numeric"/>
        <result property="digitoVerificador" javaType="String" column="rgc_dve" jdbcType="char"/>
        <result property="nombre" javaType="String" column="rgc_des" jdbcType="varchar"/>
        <result property="fechaIngreso" javaType="java.util.Date" column="rgc_fch_ing" jdbcType="date"/>
        <result property="observaciones" javaType="String" column="rgc_obs" jdbcType="varchar"/>
        <result property="fechaActualizacion" javaType="java.util.Date" column="rgc_fch_act" jdbcType="date"/>
        <result property="vigencia" javaType="Integer" column="rgc_vig" jdbcType="tinyint"/> 
        <result property="totalPagina" javaType="Integer" column="num_pag" jdbcType="numeric"/> 
        <result property="paginaActual" javaType="Integer" column="num_actual" jdbcType="numeric"/> 
    </resultMap>

    <resultMap class="java.util.HashMap" id="buscarServicioSalida">
        <result property="idServicio" javaType="Integer" column="ID_SERVICIO" jdbcType="int"/>
        <result property="idInterno" javaType="Integer" column="CODIGO" jdbcType="numeric"/>
        <result property="descripcion" javaType="String" column="GLOSA" jdbcType="varchar"/>
        <result property="fechaIngreso" javaType="java.util.Date" column="FECHA_CREACION" jdbcType="date"/>
        <result property="fechaActualizacion" javaType="java.util.Date" column="FECHA_ACTUALIZACION" jdbcType="date"/>
        <result property="vigencia" javaType="Integer" column="eve_cod_serv" jdbcType="tinyint"/> 
        <result property="totalPagina" javaType="Integer" column="num_pag" jdbcType="numeric"/> 
        <result property="paginaActual" javaType="Integer" column="num_actual" jdbcType="numeric"/>
        <result property="cuentaContableIVA" javaType="Integer" column="CTA_CTB_IVA" jdbcType="numeric"/>
        <result property="codigoTipoCargo" javaType="String" column="COD_TPO_CARGO" jdbcType="varchar"/>
        <result property="codigoTipoIngreso" javaType="Integer" column="COD_TPO_ING" jdbcType="tinyint"/>
    </resultMap>

    <resultMap class="java.util.HashMap" id="buscarSucursalSalida">
        <result property="sucursal" javaType="Integer" column="ID_SUCURSAL" jdbcType="int"/>
        <result property="codigoSII" javaType="Integer" column="CODIGOSII" jdbcType="numeric"/>
        <result property="nombre" javaType="String" column="NOMBRE" jdbcType="varchar"/>
        <result property="direccion" javaType="String" column="DIRECCION" jdbcType="varchar"/>
        <result property="comuna" javaType="String" column="COMUNA" jdbcType="varchar"/>
        <result property="fechaIngreso" javaType="java.util.Date" column="FECHA_CREACION" jdbcType="date"/>
        <result property="fechaActualizacion" javaType="java.util.Date" column="FECHA_ACTUALIZACION" jdbcType="date"/>
        <result property="vigencia" javaType="Integer" column="VIGENCIA" jdbcType="tinyint"/> 
        <result property="totalPagina" javaType="Integer" column="num_pag" jdbcType="numeric"/> 
        <result property="paginaActual" javaType="Integer" column="num_actual" jdbcType="numeric"/> 
    </resultMap>

    <resultMap class="java.util.HashMap" id="esSucursalSalida">
        <result property="sucursal" javaType="Integer" column="ID_SUCURSAL" jdbcType="int"/>
    </resultMap>

    <!-- sp_mantenedor_ins_cliente(@rut,@digitoVerificador,@nombre,@observaciones) -->
    <procedure id="ingresarCliente" parameterClass="java.util.HashMap">
        {CALL sp_mantenedor_ins_cliente(#rut#,#digitoVerificador#,#nombre#,#observaciones#)}
    </procedure>

    <!-- sp_mantenedor_cns_cliente(@filtroRut,@segFiltroRut,@numeroPag,@cantidadRegistros) -->
    <procedure id="buscarCliente" parameterClass="java.util.HashMap" resultMap="buscarClienteSalida">
        {CALL sp_mantenedor_cns_cliente(#filtroRut#,#segFiltroRut#,#numeroPag#,#cantidadRegistros#)}
    </procedure>

    <!-- sp_mantenedor_upd_cliente(@rut,@nombre,@observaciones,@vigencia) -->
    <procedure id="modificarCliente" parameterClass="java.util.HashMap">
        {CALL sp_mantenedor_upd_cliente(#rut#,#nombre#,#observaciones#,#vigencia#)}
    </procedure>

    <!-- sp_mantenedor_ins_servicio(@codigo,@glosa,@CTA_CTB_IVA,@COD_TPO_CARGO) -->
    <procedure id="ingresarServicio" parameterClass="java.util.HashMap">
        {CALL sp_mantenedor_ins_servicio(#codigo#,#glosa#,#cuentaContableIVA#,#codigoTipoCargo#)}
    </procedure>

    <!-- sp_mantenedor_cns_servicio(@filtroServicio,@numeroPag,@cantidadRegistros) -->
    <procedure id="buscarServicio" parameterClass="java.util.HashMap" resultMap="buscarServicioSalida">
        {CALL sp_mantenedor_cns_servicio(#filtroServicio#,#numeroPag#,#cantidadRegistros#)}
    </procedure>

    <!-- sp_mantenedor_upd_servicio(@idServicio,@codigo,@glosa,@vigencia,@CTA_CTB_IVA,@COD_TPO_CARGO) -->
    <procedure id="modificarServicio" parameterClass="java.util.HashMap">
        {CALL sp_mantenedor_upd_servicio(#idServicio#,#codigo#,#glosa#,#vigencia#,#cuentaContableIVA#,#tipoCargo#)}
    </procedure>

    <!-- sp_mantenedor_ins_sucursal(@sucursal,@codigoSII,@nombre,@direccion,@comuna) -->
    <procedure id="ingresarSucursal" parameterClass="java.util.HashMap">
        {CALL sp_mantenedor_ins_sucursal(#sucursal#,#codigoSII#,#nombre#,#direccion#,#comuna#)}
    </procedure>

    <!-- sp_mantenedor_cns_sucursal(@filtroSucursal,@numeroPag,@cantidadRegistros) -->
    <procedure id="buscarSucursal" parameterClass="java.util.HashMap" resultMap="buscarSucursalSalida">
        {CALL sp_mantenedor_cns_sucursal(#filtroSucursal#,#numeroPag#,#cantidadRegistros#)}
    </procedure>

    <!-- sp_mantenedor_upd_sucursal(@sucursal,@codigoSII,@nombre,@direccion,@comuna,@vigencia) -->
    <procedure id="modificarSucursal" parameterClass="java.util.HashMap">
        {CALL sp_mantenedor_upd_sucursal(#sucursal#,#codigoSII#,#nombre#,#direccion#,#comuna#,#vigencia#)}
    </procedure>

    <!-- sp_mantenedor_cns_esSucursal(@sucursal) -->
    <procedure id="esSucursal" parameterClass="java.util.HashMap" resultMap="esSucursalSalida">
        {CALL sp_mantenedor_cns_esSucursal(#sucursal#)}
    </procedure>
    
    
    <parameterMap id="setTraerNotasDeCredito" class="java.util.HashMap">
		<parameter property="folio"		       jdbcType="INT"      javaType="Integer" />
		<parameter property="tipoDocumento"    jdbcType="INT"      javaType="Integer" />
		<parameter property="codigoReferencia" jdbcType="INT"      javaType="Integer" />
	</parameterMap>	

	<resultMap class="java.util.HashMap" id="getTraerNotasDeCredito">
		<result property="folio" javaType="Integer" column="FOLIO" jdbcType="int"/>
        <result property="neto" javaType="Integer" column="MONTONETO_TOTAL" jdbcType="int"/>
        <result property="exento" javaType="Integer" column="MONTOEXENTO_TOTAL" jdbcType="int"/>
        <result property="iva" javaType="Integer" column="IVA_TOTAL" jdbcType="int"/>
        <result property="ivamandate" javaType="Integer" column="IVAMANDANTE_TOTAL" jdbcType="int"/>
        <result property="total" javaType="Integer" column="MONTOTOTAL_TOTAL" jdbcType="int"/>
    </resultMap>
    
    <statement id="traerNotasDeCredito" parameterMap="setTraerNotasDeCredito" resultMap="getTraerNotasDeCredito">
        {CALL sp_cns_ncred_por_folio(?,?,?)}
    </statement>
    
</sqlMap>
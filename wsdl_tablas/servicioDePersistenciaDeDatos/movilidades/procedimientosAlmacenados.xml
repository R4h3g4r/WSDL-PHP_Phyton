<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
    
<sqlMap namespace="movilidades.procedimientosAlmacenados">
       
    <!-- userid rut nombre n_puesto ofi_gj bca_gj desc_cargo oficina id_pst desde hasta 
    PRECEDENCIA IND_PERFIL tip_eje regional_per oficina_per regional_emp PLATAFORMA -->
    <resultMap id="listadoSolicitudes" class="java.util.HashMap">
        <result property="numero" javaType="Integer" column="id"/>
		<result property="idSolicitud" javaType="Integer" column="smv_ID"/>
		<result property="codTipoMovilidad" javaType="Integer" column="tmv_ID"/>
        <result property="tipoMovilidad" javaType="String" column="tmv_descripcion"/>
        <result property="tipoCambio" javaType="String" column="tco_descripcion"/>
        <result property="fechaIngreso" javaType="Date" column="smv_fecha_insercion"/>
        <result property="creador" javaType="String" column="smv_ejecutivo_solicitante"/>
        <result property="envioCorreo" javaType="Integer" column="smv_envio_correo"/>
		<result property="totalMovimientos" javaType="Integer" column="total_mov"/>
		<result property="pagina" javaType="Integer" column="pag"/>
    </resultMap>

    <!-- sp_cns_usu(@@usr_idn) -->
    <procedure id="obtener_listado_solicitudes" parameterClass="java.util.HashMap" resultMap="listadoSolicitudes">
        {CALL sp_cns_solicitudes(#fechaInicio#,#fechaFin#,#ejecutivo#,#cantidad#,#paginaSolicitada#)}
    </procedure>


	<resultMap id="listadoDetalleSolicitudes" class="java.util.HashMap">
        <result property="idSolicitud" javaType="Integer" column="smv_ID"/>
		<result property="ejecutivoSolicitante" javaType="String" column="smv_ejecutivo_solicitante"/>
        <result property="fechaInsercion" javaType="Date" column="smv_fecha_insercion"/>
        <result property="centroCosto" javaType="String" column="smv_centro_costo"/>
		<result property="ejecutivoResponsable" javaType="String" column="smv_ejecutivo_responsable"/>
		<result property="rutaVbAdjunto" javaType="String" column="smv_ruta_vb_adjunto"/>
		<result property="observaciones" javaType="String" column="smv_observaciones"/>
		<result property="codTipoMovilidad" javaType="Integer" column="tmv_ID"/>
		<result property="tipoMovimiento" javaType="String" column="tmv_descripcion"/>
		<result property="tipoCambio" javaType="String" column="tco_descripcion"/>
		<result property="codTipoCambio" javaType="Integer" column="tco_ID"/>
		<result property="tipoOrden" javaType="String" column="tor_descripcion"/>
		<result property="envioCorreo" javaType="Integer" column="smv_envio_correo"/>
        <result property="ejecutivoOficinaOrigen" javaType="String" column="dmu_eje_oficina_origen"/>
        <result property="ejecutivoOficinaDestino" javaType="String" column="dmu_eje_oficina_destino"/>
        <result property="mailOrigen" javaType="String" column="dmu_mail_eje_oficina_origen"/>
        <result property="mailDestino" javaType="String" column="dmu_mail_eje_oficina_destino"/>
		<result property="fonoOrigen" javaType="String" column="dmu_fono_eje_oficina_origen"/>
		<result property="fonoDestino" javaType="String" column="dmu_fono_eje_oficina_destino"/>
		<result property="jofOrigen" javaType="String" column="dmu_jof_oficina_origen"/>
		<result property="jofDestino" javaType="String" column="dmu_jof_oficina_destino"/>
		<result property="bancaOrigen" javaType="String" column="dmu_cod_banca_origen"/>
		<result property="bancaDestino" javaType="String" column="dmu_cod_banca_destino"/>
		<result property="planOrigen" javaType="String" column="dmu_cod_plan_origen"/>
		<result property="planDestino" javaType="String" column="dmu_cod_plan_destino"/>
		<result property="regionOrigen" javaType="String" column="dmu_cod_region_oficina_origen"/>
		<result property="regionDestino" javaType="String" column="dmu_cod_region_oficina_destino"/>
		<result property="comunaOrigen" javaType="String" column="dmu_cod_comuna_oficina_origen"/>
		<result property="comunaDestino" javaType="String" column="dmu_cod_comuna_oficina_destino"/>
		<result property="oficinaOrigen" javaType="String" column="dmu_cod_oficina_origen"/>
		<result property="oficinaDestino" javaType="String" column="dmu_cod_oficina_destino"/>

		<result property="rutCliente" javaType="Integer" column="dmu_rut_cliente"/>
		<result property="dvCliente" javaType="String" column="dmu_dv_cliente"/>
		<result property="nombreCliente" javaType="String" column="dmu_nombre_cliente"/>
		<result property="mailCliente" javaType="String" column="dmu_email_cliente"/>
    </resultMap>

    <procedure id="obtener_detalle_solicitud" parameterClass="java.util.HashMap" resultMap="listadoDetalleSolicitudes">
        {CALL sp_cns_detalle_solicitud(#idSolicitud#)}
    </procedure>


	<resultMap id="listadoDetalleParcialSolicitudes" class="java.util.HashMap">
        <result property="idSolicitud" javaType="Integer" column="smv_ID"/>
		<result property="ejecutivoSolicitante" javaType="String" column="smv_ejecutivo_solicitante"/>
        <result property="fechaInsercion" javaType="Date" column="smv_fecha_insercion"/>
        <result property="centroCosto" javaType="String" column="smv_centro_costo"/>
		<result property="ejecutivoResponsable" javaType="String" column="smv_ejecutivo_responsable"/>
		<result property="rutaVbAdjunto" javaType="String" column="smv_ruta_vb_adjunto"/>
		<result property="observaciones" javaType="String" column="smv_observaciones"/>
		<result property="codTipoMovilidad" javaType="Integer" column="tmv_ID"/>
		<result property="tipoMovimiento" javaType="String" column="tmv_descripcion"/>
		<result property="tipoCambio" javaType="String" column="tco_descripcion"/>
		<result property="codTipoCambio" javaType="Integer" column="tco_ID"/>
		<result property="rutaArchivodjunto" javaType="String" column="dmp_ruta_interfaz"/>
	</resultMap>

    <procedure id="obtener_detalle_solicitud_parcial" parameterClass="java.util.HashMap" resultMap="listadoDetalleParcialSolicitudes">
        {CALL sp_cns_detalle_solicitud_p(#idSolicitud#)}
    </procedure>



	<resultMap id="listadoDetalleTotalSolicitudes" class="java.util.HashMap">
		<result property="idSolicitud" javaType="Integer" column="smv_ID"/>
		<result property="ejecutivoSolicitante" javaType="String" column="smv_ejecutivo_solicitante"/>
		<result property="fechaInsercion" javaType="Date" column="smv_fecha_insercion"/>
		<result property="centroCosto" javaType="String" column="smv_centro_costo"/>
		<result property="ejecutivoResponsable" javaType="String" column="smv_ejecutivo_responsable"/>
		<result property="rutaVbAdjunto" javaType="String" column="smv_ruta_vb_adjunto"/>
		<result property="observaciones" javaType="String" column="smv_observaciones"/>
		<result property="codTipoMovilidad" javaType="Integer" column="tmv_ID"/>
		<result property="tipoMovimiento" javaType="String" column="tmv_descripcion"/>
		<result property="tipoCambio" javaType="String" column="tco_descripcion"/>
		<result property="codTipoCambio" javaType="Integer" column="tco_ID"/>
		
		<result property="dmtID" javaType="String" column="dmt_ID"/>
		<result property="regionOrigen" javaType="String" column="dmt_cod_region_oficina_origen"/>
		<result property="comunaOrigen" javaType="String" column="dmt_cod_comuna_oficina_origen"/>
		<result property="oficinaOrigen" javaType="String" column="dmt_cod_oficina_origen"/>
		<result property="jofOrigen" javaType="String" column="dmt_jof_oficina_origen"/>
		<result property="ejecutivoOficinaOrigen" javaType="String" column="dmt_eje_oficina_origen"/>
		<result property="mailOrigen" javaType="String" column="dmt_mail_eje_oficina_origen"/>
		<result property="fonoOrigen" javaType="String" column="dmt_fono_eje_oficina_origen"/>
		<result property="jofDestino" javaType="String" column="dmt_jof_oficina_destino"/>
		<result property="ejecutivoOficinaDestino" javaType="String" column="dmt_eje_oficina_destino"/>
		<result property="mailDestino" javaType="String" column="dmt_mail_eje_oficina_destino"/>
		<result property="fonoDestino" javaType="String" column="dmt_fono_eje_oficina_destino"/>
		<result property="fechaInsercion" javaType="Date" column="dmt_fecha_insercion"/>
	</resultMap>

    <procedure id="obtener_detalle_solicitud_total" parameterClass="java.util.HashMap" resultMap="listadoDetalleTotalSolicitudes">
        {CALL sp_cns_detalle_solicitud_t(#idSolicitud#)}
    </procedure>

    <procedure id="modifica_estado_solicitud" parameterClass="java.util.HashMap" >
        {CALL sp_mod_estado_solicitud(#idSolicitud#,#estado#)}
    </procedure>

    <procedure id="graba_resultado_proceso" parameterClass="java.util.HashMap" >
        {CALL sp_ing_resultado_proceso(#idSolicitud#,#ambito#,#detalleAmbito#,#exitoFallo#,#motivoFallo#,#rutCliente#,#dvCliente#,#nombreCliente#,#nombreEjecutivo#,#tipoCliente#,#bancoCliente#)}
    </procedure>
    
     <procedure id="grabar_rechazo_validacion" parameterClass="java.util.HashMap" >
        {CALL sp_ing_rechazo_validacion(#idSolicitud#,#descRechazo#,#rutCliente#,#nombreCliente#,#dvCliente#,#nombreEjecutivo#,#tipoRechazo#,#codRechazo#)}
    </procedure>

    <procedure id="graba_aviso_correo" parameterClass="java.util.HashMap" >
        {CALL sp_ing_envio_correo(#idSolicitud#,#fechaInsercion#,#rutCliente#,#dvCliente#,#nombreCliente#,#mailCliente#,#nombreEjecutivo#,#fonoEjecutivo#,#mailEjecutivo#,#nombreJof#,#nombreSucursal#,#enviado#)}
    </procedure>


	<resultMap id="listadoSolicitudesProcesadas" class="java.util.HashMap">
		<result property="numeroCorrelativo" javaType="Integer" column="id"/>
        <result property="idMovimiento" javaType="Integer" column="smv_ID"/>
		<result property="fechaProceso" javaType="Date" column="smv_fecha_procesamiento"/>
		<result property="tipoMovimiento" javaType="String" column="tmv_descripcion"/>
		<result property="tipoCambio" javaType="String" column="tco_descripcion"/>
		<result property="creadorMovimiento" javaType="String" column="smv_ejecutivo_solicitante"/>
		<result property="responsableMovimiento" javaType="String" column="smv_ejecutivo_responsable"/>
		<result property="envioCorreo" javaType="Integer" column="smv_envio_correo"/>
		<result property="total" javaType="Integer" column="smv_total_movilidades"/>
		<result property="rechazadas" javaType="Integer" column="smv_movilidades_rechazadas"/>
        <result property="exitosas" javaType="Integer" column="smv_movilidades_exitosas"/>
        
        <result property="totalMovimientos" javaType="Integer" column="totalMovimientos"/>
		<result property="pagina" javaType="Integer" column="pagina"/>
    </resultMap>

    <procedure id="obtener_listado_procesadas" parameterClass="java.util.HashMap" resultMap="listadoSolicitudesProcesadas">
        {CALL sp_cns_solicitudes_procesadas(
		<isNotNull property="rut">#rut#</isNotNull><isNull property="rut">NULL</isNull>,
		#fechaInicio#,
		#fechaFin#,
		<isNotNull property="idMovilidad">#idMovilidad#</isNotNull><isNull property="idMovilidad">NULL</isNull>,
		#ejecutivo#,
		#cantidad#,
		#paginaSolicitada#)}
    </procedure>

	<procedure id="reasignar_ejecutivo" parameterClass="java.util.HashMap" >
        {CALL sp_reasignar_ejecutivo(#idSolicitud#,#ejecutivoActual#,#ejecutivoNuevo#)}
    </procedure>
	<resultMap id="idRegistro" class="java.util.HashMap">
        <result property="idSolicitud" javaType="Integer" column="id"/>  
    </resultMap>

    <procedure id="ingresar_solicitud_movilidad" parameterClass="java.util.HashMap" resultMap="idRegistro">
        {CALL sp_ing_solicitud_movilidad(
        <isNotNull property="tipoMovilidad">#tipoMovilidad#</isNotNull><isNull property="tipoMovilidad">NULL</isNull>, 
        <isNotNull property="estadoSolicitud">#estadoSolicitud#</isNotNull><isNull property="estadoSolicitud">NULL</isNull>, 
        <isNotNull property="tipoCambio">#tipoCambio#</isNotNull><isNull property="tipoCambio">NULL</isNull>, 
        <isNotNull property="ejecutivoSol">#ejecutivoSol#</isNotNull><isNull property="ejecutivoSol">NULL</isNull>, 
        <isNotNull property="ejecutivoRes">#ejecutivoRes#</isNotNull><isNull property="ejecutivoRes">NULL</isNull>, 
        <isNotNull property="envioCorreo">#envioCorreo#</isNotNull><isNull property="envioCorreo">NULL</isNull>, 
        <isNotNull property="centroCosto">#centroCosto#</isNotNull><isNull property="centroCosto">NULL</isNull>, 
        <isNotNull property="observaciones">#observaciones#</isNotNull><isNull property="observaciones">NULL</isNull>, 
        <isNotNull property="rutaVbAdjunto">#rutaVbAdjunto#</isNotNull><isNull property="rutaVbAdjunto">NULL</isNull>, 
        <isNotNull property="fechaProcesamiento">#fechaProcesamiento#</isNotNull><isNull property="fechaProcesamiento">NULL</isNull>, 
        <isNotNull property="totalMovilidades">#totalMovilidades#</isNotNull><isNull property="totalMovilidades">NULL</isNull>, 
        <isNotNull property="movilidadesExitosas">#movilidadesExitosas#</isNotNull><isNull property="movilidadesExitosas">NULL</isNull>, 
        <isNotNull property="movilidadesRechazadas">#movilidadesRechazadas#</isNotNull><isNull property="movilidadesRechazadas">NULL</isNull>, 
        <isNotNull property="mailEjecSol">#mailEjecSol#</isNotNull><isNull property="mailEjecSol">NULL</isNull>)}
    </procedure>
    <procedure id="ingresar_detalle_mov_total" parameterClass="java.util.HashMap" >
        {CALL sp_ing_det_mov_total(#idSolicitud#,#codRegOfiOrigen#,#codComOfiOrigen#,#codOfiOrigen#,#jofOfiOrigen#,#ejeOfiOrigen#,#mailEjeOfiOrigen#,#fonoEjeOfiOrigen#,#jofOfiDestino#,#ejeOfiDestino#,#mailEjeOfiDestino#,#fonoEjeOfiDestino#)}
    </procedure>
    <procedure id="ingresar_detalle_mov_unitaria" parameterClass="java.util.HashMap" >
        {CALL sp_ing_det_mov_unitaria(#idSolicitud#,#tipoOrden#,#rutCliente#,#dvCliente#,#nombreCliente#,#mailCliente#,#codRegOfiOrigen#,#codComOfiOrigen#,#codOfiOrigen#,#jofOfiOrigen#,#ejeOfiOrigen#,#mailEjeOfiOrigen#,#fonoEjeOfiOrigen#,#codBanOrigen#,#codPlanOrigen#,#codRegOfiDestino#,#codComOfiDestino#,#codOfiDestino#,#jofOfiDestino#,#ejeOfiDestino#,#mailEjeOfiDestino#,#fonoEjeOfiDestino#,#codBanDestino#,#codPlanDestino#)}
    </procedure>
    <procedure id="ingresar_detalle_mov_parcial" parameterClass="java.util.HashMap" >
        {CALL sp_ing_det_mov_parcial(#idSolicitud#,#rutaInterfaz#,#codRegOfiOrigen#,#codComOfiOrigen#,#codOfiOrigen#,#jofOfiOrigen#,#codBanOrigen#,#codPlanOrigen#,#codRegOfiDestino#,#codComOfiDestino#,#codOfiDestino#,#jofOfiDestino#,#codBanDestino#,#codPlanDestino#)}
    </procedure>



	<resultMap id="listadoReporteProcesadas" class="java.util.HashMap">
		<result property="rut" javaType="Integer" column="rut"/>
        <result property="digitoVerificador" javaType="String" column="dv"/>
		<result property="nombreCliente" javaType="String" column="nombreCliente"/>
		<result property="email" javaType="String" column="email"/>
		<result property="tipoCambio" javaType="String" column="cambio"/>
		<result property="tipoMovimiento" javaType="String" column="movimiento"/>
		<result property="observaciones" javaType="String" column="observaciones"/>
		<result property="oficinaOrigen" javaType="String" column="oficinaOrigen"/>
		<result property="oficinaDestino" javaType="String" column="oficinaDestino"/>
		<result property="ejecutivoOrigen" javaType="String" column="ejecutivoOrigen"/>
		<result property="ejecutivoDestino" javaType="String" column="ejecutivoDestino"/>
        <result property="bancaOrigen" javaType="String" column="bancaOrigen"/>
		<result property="bancaDestino" javaType="String" column="bancaDestino"/>
        <result property="jofOrigen" javaType="String" column="jofOrigen"/>
		<result property="jofDestino" javaType="String" column="jofDestino"/>
        <result property="centroCosto" javaType="String" column="centroCosto"/>
		<result property="fechaProceso" javaType="Date" column="fechaHora"/>
		<result property="responsableMovimiento" javaType="String" column="ejecutivoResponsable"/>
        <result property="creadorMovimiento" javaType="String" column="ejecutivoSolicitante"/>
		<result property="envioCorreo" javaType="Integer" column="envioCorreo"/>
        <result property="estado" javaType="String" column="estado"/>
		<result property="rechazo" javaType="String" column="rechazo"/>
    </resultMap>

    <procedure id="obtener_reporte_procesadas" parameterClass="java.util.HashMap" resultMap="listadoReporteProcesadas">
        {CALL sp_reporte_procesadas(#idMovilidad#)}
    </procedure>


</sqlMap>    
<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
    
<sqlMap namespace="tarjetaonoff.procedimientosAlmacenados">

<parameterMap id="setCambiaEstadoTar" class="java.util.HashMap">
<parameter property="tarjeta" jdbcType="CHAR" javaType="String" />
<parameter property="estado" jdbcType="BIT" javaType="Integer" />
<parameter property="canal" jdbcType="CHAR" javaType="String" />
<parameter property="origen" jdbcType="CHAR" javaType="String" />
<parameter property="monto" jdbcType="Double" javaType="Double" />
<parameter property="pais" jdbcType="CHAR" javaType="String" />
<parameter property="usuario" jdbcType="CHAR" javaType="String" />
<parameter property="tipo" jdbcType="CHAR" javaType="String" />
<parameter property="fechaHoraActiva" jdbcType="DATETIME"   javaType="java.util.Calendar" typeHandler="cl.bci.middleware.aplicacion.persistencia.handler.CalendarTypeHandler" />
<parameter property="codError" jdbcType="CHAR" javaType="String" />
<parameter property="descError" jdbcType="CHAR" javaType="String" />
</parameterMap>

<procedure id="cambiarEstadoTarjeta" parameterMap="setCambiaEstadoTar">
{CALL proc_cambia_estado_tar(?,?,?,?,?,?,?,?,?,?,?)}
</procedure> 

<parameterMap id="setAddTarjeta" class="java.util.HashMap">
<parameter property="tarjeta" jdbcType="CHAR" javaType="String" />
<parameter property="rutCliente" jdbcType="INTEGER" javaType="Integer" />
<parameter property="dvCliente" jdbcType="CHAR" javaType="String" />
<parameter property="hash" jdbcType="CHAR" javaType="String" />
<parameter property="estado" jdbcType="BIT" javaType="Integer" />
<parameter property="fechaHora" jdbcType="DATE" javaType="java.util.Date" />
</parameterMap>
<procedure id="registrarTarjeta" parameterMap="setAddTarjeta">
{CALL proc_add_tarjeta(?,?,?,?,?,?)}
</procedure>

<!-- Consulta Informacion DAI--> 
<resultMap id="resultado" class="java.util.HashMap">
<result property="estado" column="estado"/>
</resultMap>
<procedure id="consultaEstado" parameterClass="java.util.HashMap" resultMap="resultado">
{CALL proc_get_estado_tarjeta( #tarjeta# )}
</procedure>
<!-- Consulta Informacion DAI--> 

<resultMap id="resultadoGetHashTarjeta" class="java.util.HashMap">
<result property="hashTarjeta" column="hashTarjeta"/>
</resultMap>
<procedure id="consultaHash" parameterClass="java.util.HashMap" resultMap="resultadoGetHashTarjeta">
{CALL proc_get_hash_tarjeta( #tarjeta# )}
</procedure>


<!--Obtener estado de una tarjeta de debito-->

<parameterMap id="setConsultarEstadoTDD" class="java.util.HashMap">
   <parameter property="num_tarjetaDebito"   jdbcType="VARCHAR" javaType="String" />
</parameterMap>
<resultMap id="getConsultarEstadoTDD" class="java.util.HashMap">
   <result property="estadoTDD" jdbcType="bit" javaType="Integer" /> 
</resultMap>
<procedure id="consultarEstadoTDD" parameterMap="setConsultarEstadoTDD" resultMap="getConsultarEstadoTDD">
   {CALL sp_cns_est_tdd (?)}
</procedure> 
    
<!--Ingresar una transaccion de encendido o apagada de una tarjeta de debito  -->
	
<parameterMap id="setIngresarTransaccionTarjetaDebito" class="java.util.HashMap">
   <parameter property="num_tarjetaDebito"   	jdbcType="VARCHAR" javaType="String" />
   <parameter property="tip_accion"   			jdbcType="bit"     javaType="Integer" />
   <parameter property="cnl_operacion"   		jdbcType="VARCHAR" javaType="String" />
   <parameter property="cnl_origen"   			jdbcType="VARCHAR" javaType="String" />
   <parameter property="monto"   				jdbcType="DECIMAL" javaType="Long" />
   <parameter property="pais"   				jdbcType="VARCHAR" javaType="String" />
   <parameter property="usuario"   			    jdbcType="VARCHAR" javaType="String" />
   <parameter property="tip_tarjeta"   		    jdbcType="VARCHAR" javaType="String" />
   <parameter property="fec_activacion"   		jdbcType="DATE"    javaType="Date" />
   <parameter property="rut_cliente"   		    jdbcType="INT"     javaType="Long" />
   <parameter property="dv_cliente"   			jdbcType="CHAR"    javaType="String" />
   <parameter property="cod_error"   			jdbcType="VARCHAR" javaType="String" />
   <parameter property="desc_error"   		    jdbcType="VARCHAR" javaType="String" />
   <parameter property="token"   				jdbcType="VARCHAR" javaType="String" />
</parameterMap>
<resultMap id="getIngresarTransaccionTarjetaDebito" class="java.util.HashMap">
   <result property="estadoTransaccion" jdbcType="INT" javaType="Integer" /> 
</resultMap>
<procedure id="ingresarTransaccionTarjetaDebito" parameterMap="setIngresarTransaccionTarjetaDebito" resultMap="getIngresarTransaccionTarjetaDebito">
   {CALL sp_ins_trx_tdd (?,?,?,?,?,?,?,?,?,?,?,?,?,?)}
</procedure>

    <!--Obtener todas las tarjetas de Debito que se activaran en una fecha ingresada-->
    <parameterMap id="setConsultarTDDfechaDeActivacion" class="java.util.HashMap">
        <parameter property="fechaDeEncendido"   jdbcType="VARCHAR" javaType="String" />
    </parameterMap>
    <resultMap id="getConsultarTDDfechaDeActivacion" class="java.util.HashMap">
        <result property="numeroTarjeta"    jdbcType="VARCHAR" javaType="String" /> 
        <result property="tipoTarjeta"      jdbcType="VARCHAR" javaType="String" /> 
        <result property="estadoTDD"        jdbcType="bit"     javaType="Integer" /> 
        <result property="rutClienteDebito" jdbcType="INTEGER" javaType="Integer" /> 
        <result property="dvClienteDebito" jdbcType="CHAR"     javaType="String" /> 
    </resultMap>
    <procedure id="consultarTDDfechaDeActivacion" parameterMap="setConsultarTDDfechaDeActivacion" resultMap="getConsultarTDDfechaDeActivacion">
        {CALL sp_cns_est_tdd_todas (?)}
    </procedure>
	
	<!--Obtener todas las tarjetas de credito que se activaran en una fecha ingresada-->
    <parameterMap id="setConsultarTDCfechaDeActivacion" class="java.util.HashMap">
        <parameter property="fechaDeEncendido"   jdbcType="VARCHAR" javaType="String" />
    </parameterMap>
    <resultMap id="getConsultarTDCfechaDeActivacion" class="java.util.HashMap">
        <result property="numeroTarjeta"    jdbcType="VARCHAR" javaType="String" /> 
        <result property="tipoTarjeta"      jdbcType="VARCHAR" javaType="String" /> 
        <result property="estadoTDD"        jdbcType="bit" javaType="Integer" /> 
        <result property="hashTarjeta"      jdbcType="VARCHAR" javaType="String" /> 
        <result property="rutClienteDebito" jdbcType="INTEGER" javaType="Integer" /> 
        <result property="dvClienteDebito"  jdbcType="CHAR" javaType="String" /> 
    </resultMap>
    <procedure id="consultarTDCfechaDeActivacion" parameterMap="setConsultarTDCfechaDeActivacion" resultMap="getConsultarTDCfechaDeActivacion">
        {CALL sp_cns_est_tdc_todas (?)}
    </procedure>
    
    <!--Obtener los estados de las tarjetas de debito para un cliente espesifico-->
    <parameterMap id="setConsultarEstadoTDDCliente" class="java.util.HashMap">
       <parameter property="rutClienteDebito" jdbcType="int" javaType="java.lang.Integer" /> 
    </parameterMap>
    <resultMap id="getConsultarEstadoTDDCliente" class="java.util.HashMap">
        <result property="numeroTarjeta" 		column="tdb_num_tarjeta"  	jdbcType="VARCHAR" 	javaType="String" /> 
        <result property="estadoTDD"     		column="tdb_estado"  		jdbcType="bit" 		javaType="java.lang.Integer" /> 
        <result property="rutClienteDebito"  	column="tdb_rut_cliente" 	jdbcType="int" 		javaType="java.lang.Long" /> 
    </resultMap>
    <procedure id="consultarEstadoTDDCliente" parameterMap="setConsultarEstadoTDDCliente" resultMap="getConsultarEstadoTDDCliente">
        {CALL sp_cns_est_tarjetastdd (?)}
    </procedure>
	
	<!--Obtener los estados de las tarjetas de credito para un cliente especifico-->
	<parameterMap id="setConsultarEstadosTdcTodas" class="java.util.HashMap">
		<parameter property="rutCliente"   	        jdbcType="int"  javaType="java.lang.Integer" />
	</parameterMap>
	 <resultMap id="getConsultarEstadosTdcTodas" class="java.util.HashMap">
       <result property="numeroTarjeta" 	column="tcr_num_tarjeta"   jdbcType="VARCHAR" javaType="String" /> 
       <result property="estadoTDC" 		column="tcr_estado"        jdbcType="bit" javaType="java.lang.Integer" />
       <result property="rutClienteCredito" column="tcr_rut_cliente"   jdbcType="int" javaType="java.lang.Long"  />    
     </resultMap>
	<procedure id="consultarEstadosTdcTodas" parameterMap="setConsultarEstadosTdcTodas" resultMap="getConsultarEstadosTdcTodas">
		{ CALL sp_cns_est_tarjetastdc (?)}
	</procedure>
	
</sqlMap>

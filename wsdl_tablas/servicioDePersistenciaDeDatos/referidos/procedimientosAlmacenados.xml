<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="factor.procedimientosAlmacenados">
	<procedure id="sp_grf_ins_ref"
		parameterClass="java.util.HashMap" >
		{CALL sp_grf_ins_ref(
			<isNull property="rutReferente">NULL</isNull> <isNotNull property="rutReferente">#rutReferente#</isNotNull>,
			<isNull property="dvReferente">NULL</isNull> <isNotNull property="dvReferente">#dvReferente#</isNotNull>,
			<isNull property="nombreReferente">NULL</isNull> <isNotNull property="nombreReferente">#nombreReferente#</isNotNull>,
			<isNull property="ap_paternoReferente">NULL</isNull> <isNotNull property="ap_paternoReferente">#ap_paternoReferente#</isNotNull>,
			<isNull property="ap_maternoReferente">NULL</isNull> <isNotNull property="ap_maternoReferente">#ap_maternoReferente#</isNotNull>,
			<isNull property="usuario">NULL</isNull> <isNotNull property="usuario">#usuario#</isNotNull>,
			<isNull property="rutReferido">NULL</isNull> <isNotNull property="rutReferido">#rutReferido#</isNotNull>,
			<isNull property="dvReferido">NULL</isNull> <isNotNull property="dvReferido">#dvReferido#</isNotNull>,
			<isNull property="nombreReferido">NULL</isNull> <isNotNull property="nombreReferido">#nombreReferido#</isNotNull>,
			<isNull property="ap_paternoReferido">NULL</isNull> <isNotNull property="ap_paternoReferido">#ap_paternoReferido#</isNotNull>,
			<isNull property="ap_maternoReferido">NULL</isNull> <isNotNull property="ap_maternoReferido">#ap_maternoReferido#</isNotNull>,
			<isNull property="celularReferido">NULL</isNull> <isNotNull property="celularReferido">#celularReferido#</isNotNull>,
			<isNull property="fono_contactoReferido">NULL</isNull> <isNotNull property="fono_contactoReferido">#fono_contactoReferido#</isNotNull>,
			<isNull property="emailReferido">NULL</isNull> <isNotNull property="emailReferido">#emailReferido#</isNotNull>,
			<isNull property="direccionReferido">NULL</isNull> <isNotNull property="direccionReferido">#direccionReferido#</isNotNull>,
			<isNull property="informacionReferido">NULL</isNull> <isNotNull property="informacionReferido">#informacionReferido#</isNotNull>,
			<isNull property="estado_referido">NULL</isNull> <isNotNull property="estado_referido">#estado_referido#</isNotNull>,
			<isNull property="codigo_ticket_crm">NULL</isNull> <isNotNull property="codigo_ticket_crm">#codigo_ticket_crm#</isNotNull>,
			<isNull property="canal">NULL</isNull> <isNotNull property="canal">#canal#</isNotNull>,
			<isNull property="codigoRegion">NULL</isNull> <isNotNull property="codigoRegion">#codigoRegion#</isNotNull>,
			<isNull property="comuna">NULL</isNull> <isNotNull property="comuna">#comuna#</isNotNull>,
			<isNull property="ciudad">NULL</isNull> <isNotNull property="ciudad">#ciudad#</isNotNull>,
			<isNull property="sucursal">NULL</isNull> <isNotNull property="sucursal">#sucursal#</isNotNull>
		)}
	</procedure>

	<resultMap id="resultado_sp_grf_cns_ref" class="java.util.HashMap">
		<result property="rutReferido"     javaType="long" column="num_rut"/>
		<result property="dvReferido"      javaType="String" column="dig_vrf"/>
		<result property="nombresReferido" javaType="String" column="nombre"/>
		<result property="apellidoPaternoReferido" javaType="String" column="ap_paterno"/>
		<result property="apellidoMaternoReferido" javaType="String" column="ap_materno"/>
		<result property="telefonoCelularReferido" javaType="String" column="celular"/>
		<result property="telefonoFijoReferido" javaType="String" column="fono_contacto"/>
		<result property="emailReferido" javaType="String" column="email"/>
		<result property="direccionReferido" javaType="String" column="direccion"/>
		<result property="comentariosReferido" javaType="String" column="informacion"/>
		<result property="estado" javaType="int" column="id_estado"/>
		<result property="rutReferente" javaType="String" column="num_rut_ref"/>
		<result property="dvReferente" javaType="String" column="dig_vrf_ref"/>
		<result property="ticketCrm" javaType="String" column="ticket_crm"/>
		<result property="canalReferente" javaType="String" column="canal_referente"/>
		<result property="fechaIngreso" javaType="java.util.Date" column="fecha_creacion"/>
		<result property="fechaCierre" javaType="java.util.Date" column="fecha_modifica"/>
		<result property="glosaEstadoReferido" javaType="String" column="glosa_estado"/>
	</resultMap>
	<procedure id="sp_grf_cns_ref"
		parameterClass="java.util.HashMap" resultClass="java.util.HashMap" resultMap ="resultado_sp_grf_cns_ref" >
		{CALL sp_grf_cns_ref(
			#rutReferente#,
		)}
	</procedure>
	<procedure id="sp_grf_get_ref"
		parameterClass="java.util.HashMap" resultClass="java.util.HashMap" resultMap ="resultado_sp_grf_cns_ref" >
		{CALL sp_grf_get_ref(
			#rutReferido#,
		)}
	</procedure>
	<resultMap id="resultado_sp_grf_cns_pre_id" class="java.util.HashMap">
		<result property="codigo" javaType="Integer" column="id_premio" />
		<result property="nombre" javaType="String" column="nombre" />
		<result property="descripcion" javaType="String" column="descripcion" />
	</resultMap>
	<procedure id="sp_grf_cns_pre_id"
		parameterClass="java.util.HashMap" resultMap="resultado_sp_grf_cns_pre_id">
		{CALL sp_grf_cns_pre_id(#codigoPremio#)}
	</procedure>
	<resultMap id="resultado_cns_premios" class="java.util.HashMap">
		<result property="codigoPremioVigencia" javaType="Integer" column="id_premio_vigencia" />
		<result property="codigoVigencia" javaType="Integer" column="id_vigencia" />
		<result property="codigo" javaType="Integer" column="id_premio" />
		<result property="nombre" javaType="String" column="nombre" />
		<result property="descripcion" javaType="String" column="descripcion" />
		<result property="precio" javaType="Long" column="puntos" />
	</resultMap>
	<procedure id="sp_grf_cns_pre_disp"
		parameterClass="java.util.HashMap" resultMap="resultado_cns_premios">
		{CALL sp_grf_cns_pre_disp(#fecha#)}
	</procedure>
	<procedure id="sp_grf_cns_pre_pre_vig_id" parameterClass="java.util.HashMap"
		resultMap="resultado_cns_premios">
		{CALL sp_grf_cns_pre_pre_vig_id(#codigoPremioVigencia#)}
	</procedure>
	<resultMap id="resultado_cns_referente" class="java.util.HashMap">
		<result property="rut" javaType="Long" column="rut"/>
		<result property="digitoVerificador" javaType="String" column="dv"/>
		<result property="nombres" javaType="String" column="nombre"/>
		<result property="apellidoPaterno" javaType="String" column="ap_paterno"/>
		<result property="apellidoMaterno" javaType="String" column="ap_materno"/>
		<result property="puntosDisponibles" javaType="Long" column="puntos_disponibles"/>
	</resultMap>
	<procedure id="sp_grf_cns_referente" parameterClass="java.util.HashMap"
		resultMap="resultado_cns_referente">
		{CALL sp_grf_cns_referente(#rut#)}
	</procedure>
	<resultMap class="java.util.HashMap" id="resultado_ins_canje">
		<result property="identificadorComprobante" javaType="Long" column="id_canje" />
	</resultMap>
	<procedure id="sp_grf_ins_cje" parameterClass="java.util.HashMap"
		resultMap="resultado_ins_canje">
		{CALL sp_grf_ins_cje(#rutReferente#,#canal#,#modalidadCanje#,#puntosUtilizados#,#usuarioModifica#)}
	</procedure>
	<procedure id="sp_grf_ins_cje_pre" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		{CALL sp_grf_ins_cje_pre(#idCanje#,#idPremioVigencia#,#cantidad#,#puntosUtilizados#)}
	</procedure>
	<procedure id="sp_grf_del_cje" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		{CALL sp_grf_del_cje(#idCanje#,#puntosAReponer#,#usuarioModifica#)}
	</procedure>

<resultMap id="resultado_sp_cns_ref_cje" class="java.util.HashMap">
		<result property="idReferido"      javaType="Long" column="id_referido"/>
		<result property="nombresReferido" javaType="String" column="nombre"/>
		<result property="apellidoPaternoReferido" javaType="String" column="ap_paterno"/>
		<result property="apellidoMaternoReferido" javaType="String" column="ap_materno"/>
		<result property="fechaIngreso" javaType="java.util.Date" column="fecha_creacion"/>
		<result property="estado" javaType="int" column="estado_referido"/>
		<result property="glosaEstadoReferido" javaType="String" column="glosa_estado"/>
		<result property="descripcionEstado" javaType="String" column="descripcion"/>
		<result property="emailReferido" javaType="String" column="email"/>
		<result property="fonoReferido" javaType="String" column="fono_contacto"/>
		<result property="rut" javaType="Long" column="rut"/>
		<result property="digitoVerificador" javaType="String" column="dv"/>
		<result property="fechaCierre" javaType="java.util.Date" column="fecha_modifica"/>
	</resultMap>
	<procedure id="sp_cns_ref_cje" parameterClass="java.util.HashMap" resultMap ="resultado_sp_cns_ref_cje">
		{CALL sp_cns_ref_cje(#rutReferente#,#estado#,#canal#)}
	</procedure>
	
	<procedure id="sp_act_est_ref" parameterClass="java.util.HashMap">
		{CALL sp_act_est_ref(#idReferido#,#estado#)}
	</procedure>

	<resultMap id="resultado_sp_cns_est" class="java.util.HashMap">
		<result property="codigoEstado" javaType="int" column="id_estado_referido"/>
		<result property="glosaEstado" javaType="String" column="nombre"/>
	</resultMap>
	<procedure id="sp_cns_est" parameterClass="java.util.HashMap" resultMap ="resultado_sp_cns_est">
		{CALL sp_cns_est()}
	</procedure>	
	<procedure id="sp_grf_ins_interaccion" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		{CALL sp_grf_ins_interaccion(
			#canal#, #asunto#, #rut#, #dv#, #nombres#,
			#ap_paterno#, #ap_materno#, #ejecutivo#, #tipo_banca#, #email#,
			#registrado_sgc#, #agente_responsable#, #creador#, #prioridad#, #estado_interaccion#,
			#condicion#, #origen#, #tipo#, #motivo#, #fecha_inicio#,
			#fecha_vencimiento#,
			<isNull property="descripcion">''</isNull><isNotNull property="descripcion">#descripcion#</isNotNull>,
			#plataforma#, #notas#, #usuario_creador#
		)}
	</procedure>
	<procedure id="sp_grf_ins_lead" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		{CALL sp_grf_ins_lead(
			#id_interaccion#, #rut#, #dv#, #nombres#, #ap_paterno#,
			#ap_materno#, #ejecutivo#, #tipo_banca#,
			<isNull property="codigo_area">''</isNull><isNotNull property="codigo_area">#codigo_area#</isNotNull>,
			#numero_telefono#, #tipo_telefono#,
			<isNull property="direccion">''</isNull><isNotNull property="direccion">#direccion#</isNotNull>,
			<isNull property="comuna">''</isNull><isNotNull property="comuna">#comuna#</isNotNull>,
			#email#, #responsable#,
			#creador#, #rut_patrocinador#, #dv_patrocinador#, #nombre_patrocinador#, #unidad_patrocinador#,
			#estado_lead#, #prioridad#, #unidad_negocio#, #familia_producto#, #fecha_asignacion#,
			#campana#, #notas#, #telefono_contacto_lead#
		)}
	</procedure>
	<procedure id="sp_grf_ins_cje_referido" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		{CALL sp_grf_ins_cje_referido(#canje#, #rut_referido#, #puntos#)}
	</procedure>
	<resultMap id="resultado_sp_grf_cns_cje_referido" class="java.util.HashMap">
		<result property="id_canje" column="id_canje"/>
		<result property="rut" column="rut"/>
		<result property="dv" column="dv"/>
		<result property="fecha_canje" column="fecha_canje" javaType="java.util.Date"/>
		<result property="canal" column="canal"/>
		<result property="puntos_utilizados" column="puntos_utilizados"/>
	</resultMap>
	<procedure id="sp_grf_cns_cje_referido" parameterClass="java.util.HashMap" resultMap="resultado_sp_grf_cns_cje_referido">
		{CALL sp_grf_cns_cje_referido(#rut_referido#)}
	</procedure>
	<procedure id="sp_grf_cns_cje_pre_canje" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		{CALL sp_grf_cns_cje_pre_canje(#id_canje#)}
	</procedure>
	<procedure id="sp_grf_cns_aporte_refdo_cje" parameterClass="java.util.HashMap" resultClass="java.util.HashMap">
		{CALL sp_grf_cns_aporte_refdo_cje(#id_canje#)}
	</procedure>
</sqlMap>

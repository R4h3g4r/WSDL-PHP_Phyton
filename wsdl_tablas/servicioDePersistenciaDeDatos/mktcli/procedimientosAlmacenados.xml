<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="ctl.procedimientosAlmacenados">

  <!-- ========================================================================================== ==
    == Consulta los canales
    == ========================================================================================== -->

  <resultMap id="getConsultarCanales" class="java.util.HashMap">
    <result property="identificador"      jdbcType="char" javaType="String" />
    <result property="descripcion"      jdbcType="char" javaType="String" />
    <result property="cantidadPaginas"      jdbcType="int" javaType="int" />
  </resultMap>

  <procedure id="consultarCanales" resultMap="getConsultarCanales">
     { call sp_cns_canales(#bloque#, #cantidadRegistros#) }
  </procedure>

  <!-- ========================================================================================== ==
    == Inserta o modifica un canal
    == ========================================================================================== -->

  <procedure id="modificarCanales" resultClass="int">
     { call sp_ins_mod_canal(#codCanal#, #descripcion#) }
  </procedure>

  <!-- ========================================================================================== ==
    == Consulta los productos
    == ========================================================================================== -->

  <resultMap id="getConsultarProductos" class="java.util.HashMap">
    <result property="identificador"      jdbcType="char" javaType="int" />
    <result property="nombre"      jdbcType="char" javaType="String" />
    <result property="descripcion"      jdbcType="char" javaType="String" />
    <result property="cantidadPaginas"      jdbcType="int" javaType="int" />    
  </resultMap>

  <procedure id="consultarProductos" resultMap="getConsultarProductos">
     { call sp_cns_productos(#bloque#, #cantidadRegistros#) }
  </procedure>

  <!-- ========================================================================================== ==
    == Inserta o modifica un producto
    == ========================================================================================== -->

  <procedure id="modificarProductos" resultClass="int">
     { call sp_ins_mod_producto(#identificador#, #nombre#, #descripcion#) }
  </procedure>

  <!-- ========================================================================================== ==
    == Consulta los subproductos
    == ========================================================================================== -->

  <resultMap id="getConsultarSubProductos" class="java.util.HashMap">
    <result property="identificadorSubProducto"      	jdbcType="char" javaType="int" />
    <result property="identificadorProducto"      	jdbcType="char" javaType="int" />
    <result property="nombreSubProducto"      		jdbcType="char" javaType="String" />    
    <result property="descripcionSubProducto"      	jdbcType="char" javaType="String" />
    <result property="nombreProducto"      		jdbcType="char" javaType="String" />
    <result property="descripcionProducto"      	jdbcType="char" javaType="String" />
    <result property="cantidadPaginas"			jdbcType="int" javaType="int" />    
  </resultMap>

  <procedure id="consultarSubProductos" resultMap="getConsultarSubProductos">
     { call sp_cns_sub_productos(#identificadorProducto#, #bloque#, #cantidadRegistros#) }
  </procedure>

  <!-- ========================================================================================== ==
    == Inserta o modifica un subproducto
    == ========================================================================================== -->

  <procedure id="modificarSubProductos" resultClass="int">
     { call sp_ins_mod_sub_producto(#identificador#, #identificadorProducto#, #nombre#, #descripcion#) }
  </procedure>

 <!-- ========================================================================================== ==
    == Consulta los campanas por filtro
    == ========================================================================================== -->

  <resultMap id="getConsultarCampanasPorFiltro" class="java.util.HashMap">
    <result property="identificador"      	jdbcType="char" javaType="int" />
    <result property="descripcion"      	jdbcType="char" javaType="String" />
    <result property="fechaInicio"      	javaType="java.util.Calendar" jdbcType="DATE" typeHandler="cl.bci.middleware.aplicacion.persistencia.handler.CalendarTypeHandler"/>
    <result property="prioridad"      		jdbcType="int" javaType="int" />
    <result property="fechaTermino"      	javaType="java.util.Calendar" jdbcType="DATE" typeHandler="cl.bci.middleware.aplicacion.persistencia.handler.CalendarTypeHandler"/>
    <result property="tipo"      		jdbcType="char" javaType="String" />
    <result property="cantidadPaginas"		jdbcType="int" 	javaType="int" />    
    <result property="estadoCarga"		jdbcType="char" 	javaType="String" />    
  </resultMap>

  <procedure id="consultarCampanasPorFiltro" resultMap="getConsultarCampanasPorFiltro">
     { call sp_cns_cmp_por_filtros(#idCampana#, #tipoCampana#, #idCanal#, #estadoCampana#, #prioridad#, #bloque#, #cantidadRegistros#) }
  </procedure>

  <!-- ========================================================================================== ==
    == Consulta de campanas por rut y estado
    == ========================================================================================== -->

  <resultMap id="getConsultarCampanasPorCliente" class="java.util.HashMap">
    <result property="identificador"      	jdbcType="char" javaType="int" />
    <result property="descripcion"      	jdbcType="char" javaType="String" />
    <result property="fechaTermino"      	javaType="java.util.Calendar" jdbcType="DATE" typeHandler="cl.bci.middleware.aplicacion.persistencia.handler.CalendarTypeHandler"/>
    <result property="cantidadPaginas"		jdbcType="int" 	javaType="int" />    
  </resultMap>

  <procedure id="consultarCampanasPorCliente" resultMap="getConsultarCampanasPorCliente">
     { call sp_cns_campanas_cliente(#rutCliente#, #estadoCampana#, #bloque#, #cantidadRegistros#) }
  </procedure>

  <!-- ========================================================================================== ==
    == Consulta detallada de campana
    == ========================================================================================== -->

  <resultMap id="getConsultarDetalleCampana" class="java.util.HashMap">
    <result property="descripcion"      	jdbcType="char" javaType="String" />
    <result property="prioridad"      		jdbcType="int" javaType="int" />
    <result property="fechaInicio"      	javaType="java.util.Calendar" jdbcType="DATE" typeHandler="cl.bci.middleware.aplicacion.persistencia.handler.CalendarTypeHandler"/>    
    <result property="fechaTermino"      	javaType="java.util.Calendar" jdbcType="DATE" typeHandler="cl.bci.middleware.aplicacion.persistencia.handler.CalendarTypeHandler"/>
    <result property="horaInicio"		jdbcType="int" 	javaType="int" />    
    <result property="horaTermino"		jdbcType="int" 	javaType="int" />    
    <result property="usuarioCrea"      	jdbcType="char" javaType="String" />    
    <result property="usuarioCierre"   		jdbcType="char" javaType="String" />    
    <result property="servicios"      		jdbcType="char" javaType="String" />    
    <result property="tipo"      		jdbcType="char" javaType="String" />    
    <result property="subProducto"      	jdbcType="int"  javaType="int" />
    <result property="stock"      		jdbcType="int"  javaType="int" />
    <result property="codProducto"      	jdbcType="int"  javaType="int" />
    <result property="cantDesplieguesDia"      	jdbcType="int"  javaType="int" />
    <result property="cantDesplieguesTotal"	jdbcType="int" 	javaType="int" />
    <result property="parametros"      		jdbcType="char" javaType="String" />    
  </resultMap>

  <procedure id="consultarDetalleCampana" resultMap="getConsultarDetalleCampana">
     { call sp_cns_det_campana(#identificador#) }
  </procedure>

 <!-- ========================================================================================== ==
    == Consultar canales de la campana
    == ========================================================================================== -->

  <resultMap id="getConsultarCanalesCampana" class="java.util.HashMap">
    <result property="identificadorCanal"      	jdbcType="char" javaType="String" />
    <result property="estadoCampana"     	jdbcType="char" javaType="String" />
    <result property="descripcionCanal"      	jdbcType="char" javaType="String" />
    <result property="formato"      		jdbcType="char" javaType="String" />
    <result property="link"		      	jdbcType="char" javaType="String" />
  </resultMap>

  <procedure id="consultarCanalesCampana" resultMap="getConsultarCanalesCampana">
     { call sp_cns_canales_campana(#identificadorCampana#) }
  </procedure>

 <!-- ========================================================================================== ==
    == Consultar subproductos campana
    == ========================================================================================== -->
  
  <resultMap id="getConsultarSubProductosCampana" class="java.util.HashMap">
    <result property="identificadorSubProducto"      	jdbcType="char" javaType="int" />
    <result property="identificadorProducto"      	jdbcType="char" javaType="int" />
    <result property="nombreSubProducto"      		jdbcType="char" javaType="String" />    
    <result property="descripcionSubProducto"      	jdbcType="char" javaType="String" />
  </resultMap>

  <procedure id="consultarSubProductosCampana" resultMap="getConsultarSubProductosCampana">
     { call sp_cns_sub_prod_cmp(#identificadorCampana#) }
  </procedure>

  <!-- ========================================================================================== ==
    == Modificar estado de cliente en campana
    == ========================================================================================== -->
    
  <procedure id="modificarEstadoCliente" resultClass="int">
     { call sp_mod_est_cmp_cli(#identificadorCampana#, #rutCliente#, #estado#) }
  </procedure>
  

 <!-- ========================================================================================== ==
    == Insertar Modificar republicar una campana
    == ========================================================================================== -->
    
  <procedure id="insertarModificarRepublicarCampana" resultClass="int">
     { call sp_ins_act_campana(#identificadorCampana#, 
                               #descripcion#, 
			       #prioridad#,
			       #fechaInicio#,
			       #fechaTermino#,
			       #horaInicio#,
			       #horaTermino#,
			       #usuarioCrea#,
			       #usuarioCierra#,
			       #servicios#,
			       #tipo#,
			       #formato#,
			       #cantidadDespDia#,
			       #cantidadDespTotal#,
			       #link#,
			       #subProducto#,
			       #stock#,
			       #canales#,
			       #parametrosvariables#) 
     }
  </procedure>

 <!-- ========================================================================================== ==
    == Modificar estado de la campana
    == ========================================================================================== -->
    
  <procedure id="modificarEstadoCampana" resultClass="int">
     { call sp_mod_est_campana(#identificadorCampana#, #estado#) }
  </procedure>

 <!-- ========================================================================================== ==
    == Insertar registro de historico de carga
    == ========================================================================================== -->
    
  <procedure id="registrarCargaDeArchivo" resultClass="int">
     { call sp_ins_log_hst_crg(#identificadorCampana#, #fecha#, #descripcion#) }
  </procedure>

 <!-- ========================================================================================== ==
    == Consultar historial de carga de archivos de una campana
    == ========================================================================================== -->
  
  <resultMap id="getConsultarHistorialCarga" class="java.util.HashMap">
    <result property="detalleCarga"      	jdbcType="char" javaType="String" />
  </resultMap>

  <procedure id="consultarHistorialCarga" resultMap="getConsultarHistorialCarga">
     { call sp_cns_hist_carga(#identificadorCampana#) }
  </procedure>

 <!-- ========================================================================================== ==
    == Consultar parametros de campana
    == ========================================================================================== -->
  
  <resultMap id="getConsultarParametrosCampana" class="java.util.HashMap">
    <result property="parametros"      	jdbcType="char" javaType="String" />
  </resultMap>

  <procedure id="consultarParametrosCampana" resultMap="getConsultarParametrosCampana">
     { call sp_cns_par_cmp_cli(#identificadorCampana#, #rutCliente#) }
  </procedure>

 <!-- ========================================================================================== ==
    ==Modificar el estado de un cliente respecto de una campana
    == ========================================================================================== -->
    
  <procedure id="actualizarIndicadorCampanaCliente" resultClass="int">
     { call sp_act_cmp_ind_cli(#identificadorCampana#, #rutCliente#, #servicio#, #estado#, #canal#) }
  </procedure>

 <!-- ========================================================================================== ==
    == Consultar total clientes cargados en una campana
    == ========================================================================================== -->
  
  <resultMap id="getConsultarTotalClientesCargados" class="java.util.HashMap">
    <result property="totalClientes"      	jdbcType="int" javaType="int" />
  </resultMap>

  <procedure id="consultarTotalClientesCargados" resultMap="getConsultarTotalClientesCargados">
     { call sp_cns_num_cli_car(#identificadorCampana#) }
  </procedure>

    
   <!-- ========================================================================================== ==
    == Consultar campanas cliente
    == ========================================================================================== -->
  
  <resultMap id="getConsultarCampanasCliente" class="java.util.HashMap">
    <result property="identificadorCampana"      jdbcType="char" javaType="String" />
    <result property="descripcion"      	jdbcType="char" javaType="String" />
    <result property="prioridad"      		jdbcType="int" javaType="int" />
    <result property="formato"      		jdbcType="char" javaType="String" />        
    <result property="parametros"      		jdbcType="char" javaType="String" />    	
    <result property="link"      		jdbcType="String"  javaType="String" />	
    <result property="estado"      		jdbcType="String"  javaType="String" />		
  </resultMap>

  <procedure id="consultarCampanasCliente" resultMap="getConsultarCampanasCliente">
     { call sp_cns_cmp_cli(#rutCliente#, #canal#, #servicio#, #cantidadCampanas# ) }
  </procedure>  
  
<!-- ========================================================================================== ==
    == Insertar registro de historico de carga de publicidad
    == ========================================================================================== -->
     
  <procedure id="registrarCargaDeArchivoPublicidad" resultClass="int">
     { call sp_ins_log_hst_pub_crg(#identificadorCampana#, #fecha#, #descripcion#) }
  </procedure>
  
  <!-- ========================================================================================== ==
    == Consultar historial de carga de archivos publicidad de una campana
    == ========================================================================================== -->
  
  <resultMap id="getConsultarHistorialCargaPublicidad" class="java.util.HashMap">
    <result property="detalleCarga"  jdbcType="char" javaType="String" />
  </resultMap>

  <procedure id="consultarHistorialCargaPublicidad" resultMap="getConsultarHistorialCargaPublicidad">
     { call sp_cns_hist_carga_publicidad(#identificadorCampana#) }
  </procedure>
  
  <resultMap id="getConsultarParametrosCargaClientes" class="java.util.HashMap">
    <result property="PARAMETRO" jdbcType="char" javaType="String" />
  </resultMap>
  <procedure id="consultarParametrosCargaClientes" resultMap="getConsultarParametrosCargaClientes">
     { call sp_obt_param_carga_cli(#identificador#) }
  </procedure>
  
  <resultMap id="getConsultarTotalCargaDiariaClientes" class="java.util.HashMap">
    <result property="totalRegistros"   jdbcType="int" javaType="int" />
  </resultMap>
  <procedure id="consultarTotalCargaDiariaClientes" resultMap="getConsultarTotalCargaDiariaClientes">
     { call sp_cns_carga_diaria_cli(#fechaConsulta#) }
  </procedure>
    <!-- ========================================================================================== ==
    == Consultar campañas de cliente Web o Movil
    == ========================================================================================== -->

  <resultMap id="getConsultaCampanasOmniCanalidad" class="java.util.HashMap">
	<result property="idCampana"           jdbcType="int" column="idCampana"  javaType="int" />
    <result property="descripcionCampana"  jdbcType="varchar" column="descripcionCampana" javaType="String" />
	<result property="parametrosCliente"   jdbcType="varchar" column="parametrosCliente" javaType="String" />
  </resultMap>

  <procedure id="consultaCampanasOmniCanalidad" resultMap="getConsultaCampanasOmniCanalidad">
     { call sp_cns_omnicanalidad(#rutCliente#, #canales#, #cantReg# ) }
  </procedure>
</sqlMap>

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap 
	PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
	"http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="chequeseguro.procedimientosAlmacenados">

   <parameterMap id="setObtenerNominaPorEstado" class="java.util.HashMap">
        <parameter property="rutEmpresa"      jdbcType="int"     javaType="long"/>
        <parameter property="numConvenio"     jdbcType="char"    javaType="String"/>
        <parameter property="estadoNomina"    jdbcType="char"    javaType="String" />
   </parameterMap>

   <resultMap id="getObtenerNominaPorEstado" class="java.util.HashMap">
        <result property="idNomina"       column="nom_id_nomina"    javaType="java.math.BigDecimal" />
        <result property="fechaCarga"     column="nom_fec_carga"    javaType="Date" />
        <result property="cantRechazados" column="nom_cnt_rcz"      javaType="int" />
        <result property="totalCheques"   column="nom_tot_chq"      javaType="java.math.BigDecimal" />
        <result property="rutUsuario"     column="nom_rut_usuario"  javaType="long" />
        <result property="dvUsuario"      column="nom_dv_usuario"   javaType="String" />
        <result property="numCuenta"      column="nom_num_cta"      javaType="String" />
        <result property="cantInf"        column="nom_cnt_inf"      javaType="int" />
        <result property="tipoNomina"     column="nom_tip_nomina"   javaType="String" />
        <result property="tipoAccion"     column="nom_tip_accion"   javaType="String" />
        <result property="estadoNomina"   column="est_cod"          javaType="int" />
        <result property="nomOrigen"      column="nom_nom_origen"   javaType="String" />
        <result property="nomDestino"     column="nom_nom_destino"  javaType="String" />
        <result property="estCodigo"      column="est_cod"          javaType="int" />
        <result property="estDescripcion" column="est_des"          javaType="String" />
        <result property="fechaProceso"   column="nom_fec_proc"     javaType="Date" />        
        <result property="numConvenio"    column="nom_num_cnv"      javaType="String" />
        <result property="nomRechazo"     column="nom_nom_rcz"      javaType="String" />
        <result property="fecRechazo"     column="nom_fec_rcz"      javaType="Date" />
        <result property="motRechazo"     column="nom_des_rcz"      javaType="String" />  
        <result property="rutEmpresa"     column="nom_rut_empresa"  javaType="long" />
        <result property="dvEmpresa"      column="nom_dv_empresa"   javaType="String" />
        <result property="totalPagar"     column="nom_tot_aceptados"   javaType="String" />
   </resultMap>

   <procedure id="obtenerNominaPorEstado" parameterMap="setObtenerNominaPorEstado" resultMap="getObtenerNominaPorEstado">
      { call sp_cns_res_nominas(?,?,?) }
   </procedure>
   
   <parameterMap id="setTotalesPorEstado" class="java.util.HashMap">
        <parameter property="rutEmpresa"      jdbcType="int"     javaType="long"/>
        <parameter property="numConvenio"       jdbcType="char"    javaType="String"/>        
   </parameterMap>
   
   <resultMap id="getTotalesPorEstado" class="java.util.HashMap">
        <result property="est_inicio"       column="est_inicio"        javaType="int" />
        <result property="est_observacion"  column="est_observacion"   javaType="int" />
        <result property="est_pendientes"   column="est_pendientes"    javaType="int" />
        <result property="est_enproceso"    column="est_enproceso"     javaType="int" />
        <result property="est_procesadas"   column="est_procesadas"    javaType="int" />
   </resultMap>
   
   <procedure id="obtenerTotalesPorEstado" parameterMap="setTotalesPorEstado" resultMap="getTotalesPorEstado">
      { call sp_cns_tot_nominas(?,?) }
   </procedure>
      
   <parameterMap id="setDetalleNomina" class="java.util.HashMap">
       <parameter property="idNomina"      jdbcType="int"     javaType="long"/>      
   </parameterMap>
   
   <resultMap id="getDetalleNomina" class="java.util.HashMap">
        <result property="nroLinea"            column="det_nro_linea"   javaType="int" />
        <result property="numCheque"           column="det_num_chq"     javaType="java.math.BigDecimal" />
        <result property="montoCheque"         column="det_mto_chq"     javaType="java.math.BigDecimal" />
        <result property="rutBeneficiario"     column="det_rut_benef"   javaType="int" />
        <result property="dvBeneficiario"      column="det_dv_benef"    javaType="String" />
        <result property="nombreBeneficiario"  column="det_nom_benef"   javaType="String" />
        <result property="estado"              column="estado"        javaType="String" />
        <result property="motivoRechazo"       column="motivo"         javaType="String" />
   </resultMap>
   
   <procedure id="obtenerDetalleNomina" parameterMap="setDetalleNomina" resultMap="getDetalleNomina">
      { call sp_cns_det_nomina(?) }
   </procedure>
   
   <parameterMap id="setModificarEstadoNomina" class="java.util.HashMap">
        <parameter property="idNominaSeleccionada" jdbcType="int"     javaType="long"/>
        <parameter property="estadoNomina"         jdbcType="int"     javaType="int"/>
        <parameter property="rutUsuario"           jdbcType="int"     javaType="long"/>
        <parameter property="dvUsuario"            jdbcType="char"    javaType="String"/>
        <parameter property="nombreUsuario"        jdbcType="char"    javaType="String"/>        
        <parameter property="motivo"               jdbcType="char"    javaType="String"/>      
   </parameterMap>
   
   <procedure id="modificarEstadoNomina" parameterMap="setModificarEstadoNomina" resultClass="int">
      { call sp_mod_est_nomina(?,?,?,?,?,?) }
   </procedure>

   <parameterMap id="setRegistrarNominaCheque" class="java.util.HashMap">
   		<parameter property="numeroNomina"      jdbcType="int"     javaType="long"/>
   		<parameter property="cuentaCte"      jdbcType="char"     javaType="String"/>
   		<parameter property="totalCheque"      jdbcType="int"     javaType="int"/>
   		<parameter property="rutUsuario"      jdbcType="int"     javaType="long"/>
		<parameter property="dvUsuario"      jdbcType="char"     javaType="String"/>
		<parameter property="convenio"      jdbcType="char"     javaType="String"/>
		<parameter property="rutEmpresa"      jdbcType="int"     javaType="long"/>
        <parameter property="dvEmpresa"       jdbcType="char"    javaType="String"/>
        <parameter property="tipoNomina"       jdbcType="char"    javaType="String"/>
		<parameter property="nombreOrigen"       jdbcType="char"    javaType="String"/>
		<parameter property="nombreDestino"       jdbcType="char"    javaType="String"/>
		<parameter property="numCheque"       jdbcType="int"    javaType="int"/>
		<parameter property="rutBeneficiario"      jdbcType="int"     javaType="long"/>
        <parameter property="dvBeneficiario"       jdbcType="char"    javaType="String"/>
		<parameter property="nomBeneficiario"       jdbcType="char"    javaType="String"/>
		<parameter property="idCanal"           jdbcType="char"    javaType="String"/>
   </parameterMap>
   
   <procedure id="registrarNominaCheque" parameterMap="setRegistrarNominaCheque" resultClass="int">
      { call sp_ins_nom_cargada(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) }
   </procedure>
   
   <parameterMap  id="consultarNombre" class="java.util.HashMap">
   		<parameter property="nombreNomina" jdbcType="char" javaType="String"/>
   </parameterMap>
   
   <procedure id="consultarNombreNomina" parameterMap="consultarNombre" resultClass="int">
   		{ call sp_cns_id_nomina(?)}
   </procedure>
   
   <parameterMap id="setObtenerContacto"  class="java.util.HashMap">
    	<parameter property="rutEmpresa"   jdbcType="int"      	javaType="long"/>
     	<parameter property="convenio"     jdbcType="char"      javaType="String"/>
   </parameterMap>
   
   <resultMap id="getObtenerContacto" class="java.util.HashMap">
   	 	<result property="mail"  column="cto_des_email"   javaType="String" />
   	 	<result property="idContacto"  column="cto_cod_cto"   javaType="long" />
   </resultMap>
   
    <procedure id="obtenerContacto" parameterMap="setObtenerContacto" resultMap="getObtenerContacto">
      { call sp_cns_dest_email_onp(?,?) }
   </procedure>   
   
   <parameterMap id="setActualizarCorreo"  class="java.util.HashMap">
    	<parameter property="rutEmpresa"  	 	jdbcType="int"       javaType="long"/>
    	<parameter property="digito"    		jdbcType="char"      javaType="String"/>
     	<parameter property="convenio"   	    jdbcType="char"      javaType="String"/>	
     	<parameter property="mail"     			jdbcType="char"      javaType="String"/>
     	<parameter property="idParametro"       jdbcType="int"       javaType="int"/>
   </parameterMap>

    <procedure id="actualizarCorreo" parameterMap="setActualizarCorreo" resultClass= "String">
      { call sp_ins_contacto(?,?,?,?,?) }
   </procedure> 
   
   <parameterMap id="setConsultaRelacionEmpresaNomina" class="java.util.HashMap">
       <parameter property="rutEmpresa"     jdbcType="int"      javaType="long"/>
       <parameter property="dvEmpresa"      jdbcType="char"     javaType="String"/>
       <parameter property="numNomina"      jdbcType="int"      javaType="long"/>
   </parameterMap>
   
   <procedure id="consultaRelacionEmpresaNomina" parameterMap="setConsultaRelacionEmpresaNomina" resultClass="int">
      { call sp_val_emp_nom(?,?,?) }
   </procedure>
   
   <parameterMap id="setConsultaNominaChequeSeguro" class="java.util.HashMap">
       <parameter property="numNomina"      jdbcType="int"      javaType="long"/>
   </parameterMap>
   
   <resultMap id="getConsultaNominaChequeSeguro" class="java.util.HashMap">
          <result   property="numeroNomina"          column="id_nomina"         javaType="Long" />
          <result   property="fechaCarga"            column="fecha_carga"       javaType="java.util.Date" />
          <result   property="cantidadCheques"       column="cantidad_cheques"  javaType="Integer" />
          <result   property="totalCheque"           column="total_cheque"      javaType="Long" />
          <result   property="rutUsuario"            column="rut_usuario"       javaType="Long" />
          <result   property="dvUsuario"             column="dv_usuario"        javaType="String" />
          <result   property="cuenta"                column="num_cta"           javaType="String" />
          <result   property="rutEmpresa"            column="rut_empresa"       javaType="long" />
          <result   property="dvEmpresa"             column="dv_empresa"        javaType="String" />
          <result   property="numConvenio"           column="num_convenio"      javaType="String" />
          <result   property="tipoNomina"            column="tipo_nomina"       javaType="String" />
          <result   property="tipoAccionSolicitada"  column="tipo_accion"       javaType="String" />
          <result   property="estadoNomina"          column="estado"            javaType="Integer" />
          <result   property="glosaEstadoNomina"     column="glosaEstado"       javaType="String" />
          <result   property="nombreArchivo"         column="nombre_origen"     javaType="String" />
          <result   property="nombreNomina"          column="nombre_destino"    javaType="String" />
          <result   property="motivoRechazo"         column="desc_rechazo"      javaType="String" />
          <result   property="fechaProceso"          column="fecha_proceso"     javaType="java.util.Date" />
          <result   property="nombreRechazo"         column="nombre_rechazo"    javaType="String" />
          <result   property="fechaRechazo"          column="fecha_rechazo"     javaType="java.util.Date" />
   </resultMap>
   
   <procedure id="consultaNominaChequeSeguro" parameterMap="setConsultaNominaChequeSeguro" resultMap="getConsultaNominaChequeSeguro">
      { call sp_cns_nom_id(?) }
   </procedure>
   
   <parameterMap id="setActualizarChequeSeguro" class="java.util.HashMap">
       <parameter property="idNomina"            jdbcType="int"      javaType="long"/>
       <parameter property="serialCheque"        jdbcType="int"      javaType="long"/>
       <parameter property="rutBeneficiario"     jdbcType="int"      javaType="long"/>
       <parameter property="dvBeneficiario"      jdbcType="char"     javaType="String"/>
       <parameter property="monto"               jdbcType="int"      javaType="Double"/>
       <parameter property="nombreBeneficiario"  jdbcType="varchar"  javaType="String"/>
       <parameter property="codEstado"           jdbcType="int"      javaType="int"/>
   </parameterMap>
   
   <procedure id="actualizarChequeSeguro" parameterMap="setActualizarChequeSeguro" resultClass="int">
      { call sp_edi_chq(?,?,?,?,?,?,?) }
   </procedure>
   
   <parameterMap id="setConsultaNominas" class="java.util.HashMap">
       <parameter property="rutEmpresa"     jdbcType="int"        javaType="long"/>
       <parameter property="desde"          jdbcType="datetime"   javaType="java.util.Date"/>
       <parameter property="hasta"          jdbcType="datetime"   javaType="java.util.Date"/>
       <parameter property="numeroNomina"   jdbcType="numeric"    javaType="long"/>
       <parameter property="estadoNomina"   jdbcType="int"        javaType="int"/>
       <parameter property="tipoFiltro"     jdbcType="int"        javaType="int"/>
       <parameter property="tipoConsulta"   jdbcType="int"        javaType="int"/>
   </parameterMap>
   
   <resultMap id="getConsultaNominas" class="java.util.HashMap">
          <result   property="numeroNomina"          column="id_nomina"         javaType="java.math.BigDecimal" />
          <result   property="fechaCarga"            column="fecha_carga"       javaType="java.util.Date" />
          <result   property="totalCheque"           column="total_cheque"      javaType="java.math.BigDecimal" />
          <result   property="rutUsuario"            column="rut_usuario"       javaType="long" />
          <result   property="dvUsuario"             column="dv_usuario"        javaType="String" />
          <result   property="cuenta"                column="num_cta"           javaType="String" />
          <result   property="rutEmpresa"            column="rut_empresa"       javaType="long" />
          <result   property="dvEmpresa"             column="dv_empresa"        javaType="String" />
          <result   property="numConvenio"           column="num_convenio"      javaType="String" />
          <result   property="tipoNomina"            column="tipo_nomina"       javaType="String" />
          <result   property="tipoAccionSolicitada"  column="tipo_accion"       javaType="String" />
          <result   property="estadoNomina"          column="estado"            javaType="int" />
          <result   property="glosaEstadoNomina"     column="glosaEstado"       javaType="String" />
          <result   property="nombreArchivo"         column="nombre_origen"     javaType="String" />
          <result   property="nombreNomina"          column="nombre_destino"    javaType="String" />
          <result   property="motivoRechazo"         column="desc_rechazo"      javaType="String" />
          <result   property="fechaProceso"          column="fecha_proceso"     javaType="java.util.Date" />
          <result   property="nombreRechazo"         column="nombre_rechazo"    javaType="String" />
          <result   property="fechaRechazo"          column="fecha_rechazo"     javaType="java.util.Date" />
   </resultMap>
   
   <procedure id="consultaNominas" parameterMap="setConsultaNominas" resultMap="getConsultaNominas">
      { call sp_cns_nom(?,?,?,?,?,?,?) }
   </procedure>
   
   <parameterMap id="setValidarEmpresaCheque" class="java.util.HashMap">
       <parameter property="rutEmpresa"     jdbcType="int"      javaType="long"/>
       <parameter property="serieCheque"    jdbcType="int"      javaType="long"/>
   </parameterMap>
   
   <procedure id="validarEmpresaCheque" parameterMap="setValidarEmpresaCheque" resultClass="int">
      { call sp_val_emp_chq(?,?) }
   </procedure>
   
   <parameterMap id="setConsultarNominaPorCheque" class="java.util.HashMap">
       <parameter property="rutEmpresa"     jdbcType="int"      javaType="long"/>
       <parameter property="serieCheque"    jdbcType="int"      javaType="long"/>
   </parameterMap>
   
   <resultMap id="getConsultarNominaPorCheque" class="java.util.HashMap">
          <result   property="numeroNomina"          column="id_nomina"         javaType="java.math.BigDecimal" />
          <result   property="fechaCarga"            column="fecha_carga"       javaType="java.util.Date" />
          <result   property="totalCheque"           column="total_cheque"      javaType="java.math.BigDecimal" />
          <result   property="rutUsuario"            column="rut_usuario"       javaType="long" />
          <result   property="dvUsuario"             column="dv_usuario"        javaType="String" />
          <result   property="cuenta"                column="num_cta"           javaType="String" />
          <result   property="rutEmpresa"            column="rut_empresa"       javaType="long" />
          <result   property="dvEmpresa"             column="dv_empresa"        javaType="String" />
          <result   property="numConvenio"           column="num_convenio"      javaType="String" />
          <result   property="tipoNomina"            column="tipo_nomina"       javaType="String" />
          <result   property="tipoAccionSolicitada"  column="tipo_accion"       javaType="String" />
          <result   property="estadoNomina"          column="estado"            javaType="int" />
          <result   property="glosaEstadoNomina"     column="glosaEstado"       javaType="String" />
          <result   property="nombreArchivo"         column="nombre_origen"     javaType="String" />
          <result   property="nombreNomina"          column="nombre_destino"    javaType="String" />
          <result   property="motivoRechazo"         column="desc_rechazo"      javaType="String" />
          <result   property="fechaProceso"          column="fecha_proceso"     javaType="java.util.Date" />
          <result   property="nombreRechazo"         column="nombre_rechazo"    javaType="String" />
          <result   property="fechaRechazo"          column="fecha_rechazo"     javaType="java.util.Date" />
   </resultMap>
   
   <procedure id="consultarNominaPorCheque" parameterMap="setConsultarNominaPorCheque" resultMap="getConsultarNominaPorCheque">
      { call sp_cns_nom_chq(?,?) }
   </procedure>
   
      <resultMap id="getObtenerEstadosNominas" class="java.util.HashMap">
          <result   property="cod_estado"          column="est_cod"        javaType="int" />
          <result   property="glosa_estado"        column="est_des"        javaType="String" />
   </resultMap>
   
   <procedure id="obtenerEstadosNominas" resultMap="getObtenerEstadosNominas">
      { call sp_cns_est() }
   </procedure>
   
   <parameterMap id="setConsultarPorCheque" class="java.util.HashMap">
       <parameter property="serieCheque"    jdbcType="int"      javaType="long"/>
   </parameterMap>
   
   <resultMap id="getConsultarPorCheque" class="java.util.HashMap">
          <result   property="numeroNomina"          column="id_nomina"           javaType="java.math.BigDecimal" />
          <result   property="numeroLinea"           column="numero_linea"        javaType="int" />
          <result   property="numeroCheque"          column="numero_cheque"       javaType="int" />
          <result   property="montoCheque"           column="monto_cheque"        javaType="java.math.BigDecimal" />
          <result   property="rutBeneficiario"       column="rut_beneficiario"    javaType="long" />
          <result   property="dvBeneficiario"        column="dv_beneficiario"     javaType="String" />
          <result   property="NombreBeneficiario"    column="nombre_beneficiario" javaType="String" />
          <result   property="codEstado"             column="estado"              javaType="int" />
          <result   property="glosaEstado"           column="glosaEstado"         javaType="String" />
          <result   property="codRechazo"            column="motivo_rechazo"      javaType="int" />
          <result   property="glosaRechazo"          column="glosaRechazo"        javaType="String" />
   </resultMap>
   
   <procedure id="consultarPorCheque" parameterMap="setConsultarPorCheque" resultMap="getConsultarPorCheque">
      { call sp_cns_chq(?) }
   </procedure>
   
   <parameterMap id="setCambioEstadoNomina" class="java.util.HashMap">
       <parameter property="idNomina"    jdbcType="int"      javaType="long"/>
       <parameter property="estado"      jdbcType="int"      javaType="long"/>
   </parameterMap>
   
   <resultMap id="getResultadoCambioEstadoNomina" class="java.util.HashMap">
          <result   property="resultado"          column=""           javaType="java.math.BigDecimal" />
   </resultMap>
   
   <procedure id="cambioEstadoNomina" parameterMap="setCambioEstadoNomina" resultMap="getResultadoCambioEstadoNomina">
      { call sp_upd_est_nom(?,?) }
   </procedure>
   
   <parameterMap id="setCantidadChequesValidos" class="java.util.HashMap">
       <parameter property="idNomina"    jdbcType="int"      javaType="long"/>
   </parameterMap>
   
   <resultMap id="getResultadoCantidadChequesValidos" class="java.util.HashMap">
          <result   property="resultado"          column="cant_cheque_validos"  javaType="java.math.BigDecimal" />
   </resultMap>
   
   <procedure id="consultaCantidadChequesValidos" parameterMap="setCantidadChequesValidos" resultMap="getResultadoCantidadChequesValidos">
      { call sp_cns_cant_chq(?) }
   </procedure>
</sqlMap>
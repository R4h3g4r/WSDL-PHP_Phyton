<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE sqlMap      
    PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"      
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">
    
<sqlMap namespace="historialcliente.procedimientosAlmacenados">
       
    <resultMap id="listadoHistorialCliente" class="java.util.HashMap">
        <result property="id" javaType="String" column="acc_id"/>
        <result property="rutCliente" javaType="String" column="rut_cliente"/>
		<result property="dvCliente" javaType="String" column="dv_cliente"/>
		<result property="tipoAccion" javaType="String" column="tipo_accion"/>
		<result property="fecha" javaType="Date" column="fecha"/>
		<result property="banca" javaType="String" column="banca"/>
		<result property="canal" javaType="String" column="canal"/>
		<result property="subCanal" javaType="String" column="sub_canal"/>
		<result property="ejecutivo" javaType="String" column="ejecutivo"/>
		<result property="sucursal" javaType="String" column="sucursal"/>
		<result property="enlace" javaType="String" column="acc_cli_enl"/>
		<result property="descripcion" javaType="String" column="acc_cli_des"/>
    </resultMap>

    <procedure id="sp_bus_acc_cli" parameterClass="java.util.HashMap" resultMap="listadoHistorialCliente">
        {CALL sp_bus_acc_cli(#rutCliente#,#dvCliente#,#tipoCanal#,#fechaHasta#,#fechaDesde#,#esBusquedaInicial#,#tipoAccion#)}
    </procedure>

    <resultMap id="detalleAccion" class="java.util.HashMap">
        <result property="id" javaType="String" column="cli_id"/>
        <result property="orden" javaType="String" column="acc_orden"/>
        <result property="dato" javaType="String" column="acc_dato"/>
        <result property="glosa" javaType="String" column="acc_glosa"/>
        <result property="formato" javaType="String" column="acc_formato"/>
        <result property="fecha" javaType="Date" column="acc_fecha_ins"/>
    </resultMap>

    <procedure id="sp_det_acc_cli" parameterClass="java.util.HashMap" resultMap="detalleAccion">
        {CALL sp_det_acc_cli(#idInternoAccion#)}
    </procedure>
    
    <resultMap id="nuevaAccionCliente" class="java.util.HashMap">
        <result property="id" javaType="String" column="acc_cli_id"/>
    </resultMap>

    <procedure id="sp_ing_acc_cli" parameterClass="java.util.HashMap" resultMap="nuevaAccionCliente">
        {CALL sp_ing_acc_cli(#acc_rutCliente#,#acc_dvCliente#,#tip_accCod#,#acc_cliTipCliente#,#acc_cliFec#,#acc_cliBca#,#acc_cliCnl#,#acc_cliSubCanal#,#acc_cliCodEjecutivo#,#acc_cliCodSucursal#,#acc_cliEnl#,#acc_cliDes#)}
    </procedure>
    
    <procedure id="sp_ing_det_cmp_acc" parameterClass="java.util.HashMap">
        {CALL sp_ing_det_cmp_acc(#acc_cliId#,#detacc_ord#,#detacc_dato#,#detacc_glosa#,#detacc_formato#)}
    </procedure>
    
    
<!--     elementos para consulta de simulaciones por producto de clientes de cartera -->
	<parameterMap id="setContadoresSimulacion" class="java.util.HashMap">
		<parameter property="ejecutivo"   jdbcType="varchar"  javaType="java.lang.String" />
		<parameter property="tipoConsumo" jdbcType="varchar"  javaType="java.lang.String" />
		<parameter property="prodConsumo" jdbcType="varchar"  javaType="java.lang.String" />
		<parameter property="tipoHip"     jdbcType="varchar"  javaType="java.lang.String" />
		<parameter property="prodHip"     jdbcType="varchar"  javaType="java.lang.String" />
		<parameter property="cantDias"    jdbcType="INTEGER"          javaType="java.lang.Integer" />
		<parameter property="cantSimula"  jdbcType="INTEGER"          javaType="java.lang.Integer" />
	</parameterMap>
	<resultMap id="getContadoresSimulacion" class="java.util.HashMap">
		<result property="consumo" jdbcType="INT" javaType="java.lang.Integer"  column="consumo" />
		<result property="hipotecario" jdbcType="INT" javaType="java.lang.Integer"  column="hipotecario" />
	</resultMap>
	<procedure id="contadoresSimulacion" parameterMap="setContadoresSimulacion" resultMap="getContadoresSimulacion">
		{ CALL sp_cns_simulacion(?,?,?,?,?,?,?) }
	</procedure>
	
	<parameterMap id="setDetalleSimulacion" class="java.util.HashMap">
		<parameter property="ejecutivo"   jdbcType="varchar"  javaType="java.lang.String" />
		<parameter property="tipoProducto" jdbcType="varchar"  javaType="java.lang.String" />
		<parameter property="producto" jdbcType="varchar"  javaType="java.lang.String" />
		<parameter property="cantDias"    jdbcType="INTEGER"          javaType="java.lang.Integer" />
		<parameter property="cantSimula"  jdbcType="INTEGER"          javaType="java.lang.Integer" />
	</parameterMap>
	<resultMap id="getDetalleSimulacion" class="java.util.HashMap">
		<result property="rutCliente" jdbcType="varchar" javaType="java.lang.String"  column="rut" />
		<result property="dvCliente" jdbcType="varchar" javaType="java.lang.String"  column="dv" />
		<result property="nombreCliente" jdbcType="varchar" javaType="java.lang.String"  column="nombre" />
		<result property="fecha" jdbcType="DATE"    javaType="java.util.Date"  column="fecha_simula" />
		<result property="canal" jdbcType="INT" javaType="java.lang.Integer"  column="canal" />
		<result property="subcanal" jdbcType="INT" javaType="java.lang.Integer"  column="sub_canal" />
		<result property="cantSimula" jdbcType="INT" javaType="java.lang.Integer"  column="producto" />
	</resultMap>
	<procedure id="detalleSimulacion" parameterMap="setDetalleSimulacion" resultMap="getDetalleSimulacion">
		{ CALL sp_cns_det_sim_prod(?,?,?,?,?) }
	</procedure>
</sqlMap>    